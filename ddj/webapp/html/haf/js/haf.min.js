!function(a,b,c){function e(a){var b="object"==typeof a?Object.prototype.toString.call(a):typeof a;switch(b){case"[object Array]":return"array";case"[object Object]":return"object";case"[object Date]":return"date";default:return b}}function f(a){var g,b=[],c="array"==e(a),d=function(a){return"object"==typeof a&&null!=a?f(a):/^(string)$/.test(typeof a)?'"'+a.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"')+'"':a};switch(e(a)){case"array":c=!0;break;case"object":c=!1;break;case"date":return d(a.toString());case"function":return"'function'";default:return d(a)}for(g in a)c?b.push(d(a[g])):b.push('"'+g+'":'+d(a[g]));return c?"["+b.join(",")+"]":"{"+b.join(",")+"}"}function g(a){var b="";return c.each(a,function(a,d){"object"==e(d)?c.each(d,function(c,d){b+="&"+a+"."+c+"="+encodeURIComponent(d)}):"array"==e(d)?c.each(d,function(c,d){b+="&"+a+"="+encodeURIComponent(d)}):b+="&"+a+"="+encodeURIComponent(d)}),b.replace(/^&/,"")}function i(a){var a=c.extend({type:"POST",async:"true",dataType:"json",beforeSend:function(){0==h&&HAF.showMask("请稍后..."),h++},complete:function(){h--,0==h&&HAF.showMask(!1)}},a);c.ajax(a)}function j(){try{a.open("","_parent",""),a.close(),a&&(a.location="about:blank")}catch(b){a.location="about:blank"}}function k(a,b,d){if(!a)return"";if("array"==e(a)){var f=[];return c.each(a,function(a,c){f.push("undefined"==typeof c[b]?"":c[b])}),d?f.join(d):f}return"undefined"==typeof a[b]?"":a[b]}function l(a,b,d){"object"==typeof b?c.extend(a,b):a[b]=d}var d,h;a.CONTEXT_PATH||(a.CONTEXT_PATH="/haf"),a.HAF||(a.HAF={}),d=CONTEXT_PATH,h=0,c.ajaxSetup({error:function(a,b,c){200==a.status&&a.responseText?alert(a.responseText):alert("系统错误："+b+" - "+c)}}),c.extend(a.HAF,{basePath:function(a){return arguments.length>0?(d=a,void 0):d},stringify:function(a){return f(a)},dataType:function(a){return e(a)},urlSerialize:function(a){return g(a)},closeWindow:function(){j()},ajax:function(a){i(a)},getKeyValue:function(a,b,c){return k(a,b,c)},setKeyValue:function(a,b,c){l(a,b,c)}})}(window,void 0,jQuery),function(a,b,c){a.HAF||(a.HAF={}),c.extend(a.HAF,{showMask:function(){var d,e,f,g,h,i,j,a=[!0,!1,!1,""],b=0;for(d=0;d<arguments.length;d++)"boolean"==typeof arguments[d]?a[b++]=arguments[d]:a[3]=arguments[d];return e=a[0],f=a[1],g=a[2],h=a[3],a[3]&&(f=!0),i=c(".haf-body-mask"),j=c(document.body),e?(j.addClass("haf-mask-show"),0==i.size()&&(i=c("<div class='haf-body-mask'><div class='haf-body-mask-front'></div><div class='haf-body-mask-back'></div></div>"),j.append(i)),f?i.find(".haf-body-mask-front").html("<div class='haf-mask-msg'><div class='haf-mask-msg-inner'>"+(h||"")+"</div></div>"):i.find(".haf--mask-msg").remove(),g&&i.unbind("click").click(function(){HAF.showMask(!1)}),i.show(),void 0):(i.size()>0&&(i.hide(),j.removeClass("haf-mask-show")),void 0)}})}(window,void 0,jQuery),function(a,b,c){function i(a){var b,d,e,f;if(a=c.extend({backdrop:"static",title:"&nbsp;",content:"&nbsp;",width:"650px",forceInit:!0},a),d="_haf_dialog_",e=function(){a.title&&b.find(".modal-title").empty().append(a.title),a.content&&b.find(".modal-body").empty().append(a.content),"function"==typeof a.ready&&a.ready(b),"function"==typeof a.success&&b.find(".btn-primary").unbind("click").click(function(){var c=a.success(b);("boolean"!=typeof c||0!=c)&&b.modal("toggle")})},a.key){if(d+=a.key,b=c("#"+d),b.size()>0)return b.modal("toggle"),a.backdrop&&b.data("bs.modal").$backdrop.css("z-index",g++),b.data("bs.modal").$element.css("z-index",g++),a.forceInit&&e(),void 0}else d+=(new Date).getTime();f='<div id="'+d+'" class="modal fade" data-backdrop="'+a.backdrop+'">'+'<div class="modal-dialog haf-dialog" style="width:'+a.width+'">'+'<div class="modal-content">'+'<div class="modal-header">'+'<button type="button" class="close" data-dismiss="modal">&times;</button>'+'<h4 class="modal-title">'+"</h4>"+"</div>"+'<div class="modal-body">'+"</div>"+'<div class="modal-footer">'+'<button type="button" class="btn btn-default" data-dismiss="modal">关&nbsp;闭</button>'+("function"==typeof a.success?'<button type="button" class="btn btn-primary">确&nbsp;定</button>':"")+"</div>"+"</div>"+"</div>"+"</div>",b=c(f),b.appendTo("body"),e(),b.modal("toggle"),a.backdrop&&b.data("bs.modal").$backdrop.css("z-index",g++),b.data("bs.modal").$element.css("z-index",g++)}function j(a){var k,l,m,n,o,b=c.extend({backdrop:"static",rootId:"COM_ROOT",rootSelect:!0,deptLoad:"",singleSelect:!1},a),g={},h=HAF.basePath()+d,j=HAF.basePath()+e;b.deptLoad||(b.deptLoad=b.rootId),i({key:"psn_sel",title:"人员选择",content:f.selectPsn,backdrop:b.backdrop,width:"700px",ready:function(a){k=a.find("div[haf-comp-id='deptTree'] ul"),l=a.find("div[haf-comp-id='deptTreeBtns'] .dropdown-menu li"),m=a.find("div[haf-comp-id='personList'] table"),n=a.find("div[haf-comp-id='personSelected']"),o=a.find("div[haf-comp-id='personSelectedBtns']"),k.tree({lines:!0,url:h+"?orgId="+b.rootId+"&getSelf=true",onBeforeExpand:function(a){k.tree("options").url=h+"?getSelf=false&orgId="+a.id},onSelect:function(a){m.datagrid("load",{deptId:a.id})}}),b.rootSelect?l.parent().prev().css("visibility","visible"):l.parent().prev().css("visibility","hidden"),l.click(function(){var a=k.tree("getRoot"),d=c(this).index(),e="";0==d&&"COM_ROOT"!=a.id?e=h+"?orgId=COM_ROOT&getSelf=true":1==d&&"COM_ROOT"!=a.id?e=h+"?orgId="+a.id+"&getSelf=true&getParent=true":2==d&&a.id!=b.deptLoad&&(e=h+"?orgId="+b.deptLoad+"&getSelf=true"),e&&c.get(e+"&t"+(new Date).getTime(),"",function(b){k.tree({url:null,data:b}),a=k.tree("getRoot"),null!=a&&k.tree("select",a.target)})}),m.datagrid({fit:!0,striped:!0,method:"POST",rownumbers:!0,border:!1,checkbox:!0,singleSelect:b.singleSelect,url:j,queryParams:{deptId:b.deptLoad},idField:"id",frozenColumns:[[{field:"id",checkbox:!0},{field:"name",title:"姓名",width:70,align:"center"},{field:"empNumber",title:"工号",width:70,align:"center"}]],columns:[[{field:"positionName",title:"职位",width:120,align:"center"},{field:"departmentName",title:"部门",width:120,align:"center"},{field:"officePhone",title:"办公电话",width:100,align:"center"},{field:"mobile",title:"移动长号",width:100,align:"center"}]],onSelect:function(a,c){var d=n.find("span[dataId='"+c.id+"']");0==d.size()&&(b.singleSelect&&(n.children().remove(),g={}),n.append("<span dataId='"+c.id+"'>"+c.name+"["+c.empNumber+"]</span>"),g[c.id]=c)},onUnselect:function(a,b){var c=n.find("span[dataId='"+b.id+"']");c.size()>0&&c.remove()},onSelectAll:function(a){c.each(a,function(a,b){var c=n.find("span[dataId='"+b.id+"']");0==c.size()&&(n.append("<span dataId='"+b.id+"'>"+b.name+"["+b.empNumber+"]</span>"),g[b.id]=b)})},onUnselectAll:function(a){c.each(a,function(a,b){var c=n.find("span[dataId='"+b.id+"']");c.size()>0&&c.remove()})}}),n.click(function(a){var b=c(a.target);b.is("span")&&(b.is(".selected")?b.removeClass("selected"):b.addClass("selected"))}),o.find("a").click(function(){var e,f,g,h,i,a=n.find(".selected"),b=a.size(),d=c(this).index();if(5==d)n.find("span:not(.selected)").addClass("selected");else if(0==b)return;if(e=b==n.find("span").size(),0!=d||e)if(3!=d||e)if(1!=d||e)if(2!=d||e)4==d?(a.remove(),m.datagrid("clearSelections")):6==d&&a.removeClass("selected");else{for(g=[],a=a.not(":last-child"),h=a.size()-1;h>=0;h--)g.push(a[h]);for(h=0;h<g.length;h++)f=c(g[h]).clone(),i=c(g[h]).next(),i.is(".selected")||(f.insertAfter(i),c(g[h]).remove())}else a.not(":first-child").each(function(){var a=c(this).clone(),b=c(this).prev();b.is(".selected")||(a.insertBefore(b),c(this).remove())});else f=a.clone(),a.remove(),f.insertAfter(n.find("span:last"));else f=a.clone(),a.remove(),f.insertBefore(n.find("span:first"))}),a.find("a[href='#']").attr("href","javascript:void(0)")},success:function(a){var d=[];return n.find("span").each(function(){d.push(g[c(this).attr("dataId")])}),0==d.length?(alert("尚未选择任何人员"),!1):("function"==typeof b.success&&(a.modal("toggle"),b.success(d)),!1)}})}function k(){}var d,e,f,g,l,m;a.HAF&&(a.HAF.Dialog||(a.HAF.Dialog={}),d="/comorg/public/getOrgChildren.do",e="/comorg/public/getPsnByDept.do",g=1e3,f={selectPsn:'<table class="person-select"><tr><td><div haf-comp-id="deptTreeBtns"><div class="dropdown"><a href="#" data-toggle="dropdown"><span class="glyphicon glyphicon-list"></span>&nbsp;<span haf-comp-id="deptLabel"></span>&nbsp;<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#">股份公司</a></li><li><a href="#">上级部门</a></li><li><a href="#">我的部门</a></li></ul></div></div><div haf-comp-id="deptTree"><div><ul></ul></div></div></td><td><div haf-comp-id="personList"><table></table></div></td><td><div haf-comp-id="personSelected"></div><div haf-comp-id="personSelectedBtns"><a href="#"><span class="glyphicon glyphicon-open"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-up"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-down"></span></a><a href="#"><span class="glyphicon glyphicon-download-alt"></span></a><a href="#"><span class="glyphicon glyphicon-remove"></span></a><a href="#"><span class="glyphicon glyphicon-saved"></span></a><a href="#"><span class="glyphicon glyphicon-share-alt"></span></a></div></td></tr></table>',flowConfirm:'<div class="form-horizontal flow-confirm"><div class="form-group"><label class="col-xs-3 control-label">操作类型</label><div class="col-xs-8"><input class="form-control" haf-comp-id="operateName" readonly></div></div><div class="form-group" haf-comp-id="nextNodeRow"><label class="col-xs-3 control-label">下一处理环节<span></span></label><div class="col-xs-8"><input class="form-control"  haf-comp-id="nextNodeName" readonly></div></div><div class="form-group" haf-comp-id="nextPersonRow"><label class="col-xs-3 control-label">下一处理人<span></span></label><div class="col-xs-7"><input class="form-control"  haf-comp-id="nextPersonName" readonly><input class="form-control" type="hidden" haf-comp-id="nextPersonUsername" readonly></div><div class="col-xs-2"><button class="btn btn-info" haf-comp-id="authorSelector">选择…</button></div></div><div haf-comp-id="commentsAddRow" class="form-group"><label class="col-xs-3 control-label">批示意见</label><div haf-comp-id="commentsAdd" class="col-xs-8"><span class="btn btn-link">&nbsp;添加&gt;&gt;</span></div></div><div class="form-group" haf-comp-id="flowCommentRow"><label class="col-xs-3 control-label">批示意见</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="flowComment" rows="3"></textarea></div><div class="col-xs-8 col-xs-offset-3" haf-comp-id="tempComments"><span>同意</span><span>批准</span><span>不同意</span><span>返回再议</span><span>请处理</span><span>请尽快执行</span></div></div><div class="form-group" haf-comp-id="flowMessageRow"><label class="col-xs-3 control-label">消息提醒</label><div class="col-xs-8"><input class="form-control"  haf-comp-id="flowMessage"></div></div></div>',createComm:'<div class="form-horizontal"><input type="hidden" haf-comp-id="refId"><input type="hidden" haf-comp-id="refKey"><div class="form-group"><label class="col-xs-3 control-label">消息主题</label><div class="col-xs-8"><input class="form-control" haf-comp-id="subject"></div></div><div class="form-group"><label class="col-xs-3 control-label">回复人<span></span></label><div class="col-xs-6" ><input class="form-control"  haf-comp-id="replierName" readonly><span style="display:none"><input haf-comp-id="replierId"></span></div><div class="col-xs-2"><button class="btn btn-info" haf-comp-id="replierSelector">选择…</button></div></div><div class="form-group" haf-comp-id="contentRow"><label class="col-xs-3 control-label">沟通内容</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="content" rows="3"></textarea></div></div></div>',replyComm:'<div class="form-horizontal comm-reply"><input type="hidden" haf-comp-id="id"><div class="form-group"><label class="col-xs-3 control-label">发起人</label><div class="col-xs-6"><input class="form-control" haf-comp-id="creatorName" readonly></div><div class="col-xs-2"><span haf-comp-id="ref-form" class="btn btn-link">关联业务表单</span></div></div><div class="form-group"><label class="col-xs-3 control-label">主题</label><div class="col-xs-8"><input class="form-control" haf-comp-id="subject" readonly></div></div><div class="form-group"><label class="col-xs-3 control-label">沟通内容</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="content" rows="3" readonly></textarea></div></div><div class="form-group"><label class="col-xs-3 control-label">回复内容</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="replyContent" rows="3"></textarea></div></div></div>'},l={modal:function(a){i(a)},selectPsn:function(a){j(a)},selectOrg:function(a){k(a)},HTMLTemplate:f},m=function(a,b){if("string"==typeof a)l[a](b);else{var b=a||{};i(b)}},c.extend(a.HAF.Dialog,l),c.extend(a.HAF,{dialog:function(a,b){m(a,b)}}))}(window,void 0,jQuery),function(window,undefined,$){function _initDefMessages(){var a=_currentPerson.name,b=_flowBase.name;_messages={submit:a+_getButtonText("submit")+"了"+b+"，请处理",reject:a+_getButtonText("reject")+"了您的"+b+"，请查阅",append:a+_getButtonText("append")+"给您了"+b+"，请处理",handover:a+"将"+b+"转给您处理"+"，请查阅",notify:a+_getButtonText("notify")+"您及时处理"+b+"，请查阅",deliver:a+"传给您的"+b+"，请查阅",authorize:a+"授权您处理"+b+"，请查阅",jump:a+"将"+b+"跳转给您，请处理",replace:a+"将"+b+"处理人替换为您，请处理"}}function _setIds(a,b){HAF.setKeyValue(_ids,a,b)}function _getIds(a){return HAF.getKeyValue(_ids,a)}function _isStartNode(a){var a=a||_getIds("nodeId");return a&&a==_options.startNode}function _getStartNode(){return _options.startNode||""}function _setStartNode(a){_options.startNode=a}function _isEndNode(a){var b,c;if(a=a||_getIds("nodeId"),a&&_options.endNode)for(b=_options.endNode.split(","),c=0;c<b.length;c++)if(a==b[c])return!0;return!1}function _getEndNode(){return _options.endNode||""}function _setEndNode(a){_options.endNode=a}function _isFirstNode(a){var a=a||_getIds("nodeId");return a&&a==_options.firstNode}function _getFirstNode(){return _options.firstNode||""}function _setFirstNode(a){_options.firstNode=a}function _isLastNode(a){var b,c;if(a=a||_getIds("nodeId"),a&&_options.lastNode)for(b=_options.lastNode.split(","),c=0;c<b.length;c++)if(a==b[c])return!0;return!1}function _getLastNode(){return _options.lastNode||""}function _setLastNode(a){_options.lastNode=a}function _setOperateType(a){_flowContext.operateType=a}function _getOperateType(){return _flowContext.operateType}function _getButton(a){var a=a||_getOperateType();return _buttons[a]}function _getButtonText(a){var a=a||_getOperateType();return _buttons[a]?_buttons[a].text:a||""}function _getButtonValue(a){var a=a||_getOperateType();return _buttons[a].value}function _getNodeValue(a,b){if(!a)return"";var c=_oFlowNodes[a];return c?b?c[b]||"":c:""}function _initContext(){_flowContext=$.extend({assigners:{},processVar:{},subProcessVar:{}},_ids)}function _resetContext(){_initContext();for(var a=0;a<arguments.length;a++)"string"==typeof arguments[a]?_flowContext.operateType=arguments[a]:$.extend(_flowContext,arguments[a]);_currentTask&&(_flowContext.operater=_currentTask.assignerId)}function _setContext(a,b){HAF.setKeyValue(_flowContext,a,b)}function _setAssigner(a,b){HAF.setKeyValue(_flowContext.assigners,a,b)}function _setProcessVar(a,b){HAF.setKeyValue(_flowContext.processVar,a,b)}function _setSubProcessVar(a,b){HAF.setKeyValue(_flowContext.subProcessVar,a,b)}function _setBizData(a,b){HAF.setKeyValue(_bizData,a,b)}function _getFlowBase(){return _flowBase}function _getFlowNodes(){return _flowNodes}function _getCurrentNode(){var a=_getIds("nodeId");return a?_oFlowNodes[a]:{}}function _getCurrentUsername(){return _currentUsername}function _getCurrentDate(){return _currentDate}function _getCurrentPerson(){return _currentPerson}function _getCurrentDept(){return _currentPerson.departmentId}function _getFlowMessage(){var a=arguments[0]||_getOperateType();return _messages[a]}function _setNextNodes(a){_nextNodes=a}function _getNextNodes(){return _nextNodes}function _getValue(a,b){return a[b]||""}function _disableButtons(){$(".flow-form-header .flow-buttons .btn").each(function(){this.disabled=!0}),window.setTimeout(function(){$(".flow-form-header .flow-buttons .btn").each(function(){this.disabled=!1})},3e3)}function _init(a){$.extend(!0,_options,a),$.each(_urls,function(a,b){_urls[a]=HAF.basePath()+b}),_setIds(_options.ids),_options.submitUrl&&(_urls.submit=HAF.basePath()+_options.submitUrl),HAF.ajax({url:_urls.init,data:_ids,success:function(a){var c,d,b=_initData(a);a=null,b?(_options.flowMessage&&$.extend(_messages,_options.flowMessage),_oNodeButtons&&($(".flow-form-header").append('<div class="btn-toolbar flow-buttons"><div class="btn-group"></div></div>'),c=$(".flow-form-header .flow-buttons .btn-group"),$.each(_buttons,function(a,b){var d,e;_oNodeButtons[a]&&(d=$('<button class="btn">'+b.text+"</button>"),e=$('<div class="btn-group flow-btn-'+a+'"></div>'),e.append(d).appendTo(c),b.clsClass&&d.addClass(b.clsClass),d.click(function(){_command($(this),a)}))})),_flowHiComments&&_flowHiComments.length&&(d=$("div.flow-user-comments"),d.size()>0&&$.each(_flowHiComments,function(a,b){d.append('<div class="form-group"><label class="col-xs-2 control-label">'+_getValue(b,"nodeName")+"</label>"+'<div class="col-xs-7">'+'<p class="form-control-static">'+_getValue(b,"operaterName")+"</p>"+"</div>"+'<div class="col-xs-1">'+'<p class="form-control-static">'+_getButtonText(_getValue(b,"operateType"))+"</p>"+"</div>"+'<div class="col-xs-2">'+'<p class="form-control-static">'+_getValue(b,"operateTime")+"</p>"+"</div>"+'<div class="col-xs-10 col-xs-offset-2">'+'<p class="form-control-static">'+_getValue(b,"opinion")+"</p>"+"</div>"+"</div>")})),"function"==typeof _options.ready&&_options.ready()):_flowInsts&&_flowInsts.length>1?_selectInst():_currentTasks&&_currentTasks.length>1?_selectTask():alert("流程初始化失败，系统中无相关流程信息")}})}function _initData(flowData){return $.each(flowData,function(k){eval("_"+k+"=flowData."+k)}),_flowBase&&_flowBase.id&&_flowNodes&&_flowNodes.length?(_setIds("flowDefId",_flowBase.id),_getFirstNode()||_setFirstNode(_flowNodes[0].id),_flowInst&&_flowInst.actInstId?(_setIds("instId",_flowInst.actInstId),_isNewFlow=!1):_setIds("nodeId",_getFirstNode()),_oFlowNodes={},$.each(_flowNodes,function(a,b){_oFlowNodes[b.id]=b}),_oNodeButtons={},_nodeButtons&&_nodeButtons.length?($.each(_nodeButtons,function(a,b){_oNodeButtons[b.key]=b}),$.each(_oNodeButtons,function(a,b){_buttons[a]?$.each(b,function(b,c){c&&(_buttons[a][b]=c)}):_buttons[a]=b})):(_isNewFlow||_isFirstNode())&&$.each(_buttons_new,function(a,b){_oNodeButtons[b]=_buttons[b]}),$.each(_buttons_def,function(a,b){_oNodeButtons[b]=_buttons[b]}),_authorizedTasks&&_authorizedTasks.length?_oNodeButtons.reauthorize||(_oNodeButtons.reauthorize=_buttons.reauthorize):_oNodeButtons.reauthorize=!1,_oNodeButtons.claim=_isTaskPool&&!_isClaimedTask?_buttons.claim:!1,_isTaskPool&&_isClaimedTask||(_oNodeButtons.backpool=!1),_currentTask&&_currentTask.id&&(_setIds("nodeId",_currentTask.nodeId),_setIds("executionId",_currentTask.actExecutionId),"authorize"==_currentTask.lastOperateType?(_oNodeButtons.authorize=!1,_oNodeButtons.handover=!1):"handover"==_currentTask.lastOperateType?(_oNodeButtons.authorize=!1,_oNodeButtons.handover=!1):"append"==_currentTask.lastOperateType&&(_oNodeButtons.append=!1),_currentTask.classify==_classify_hangup&&(_oNodeButtons.hangup=!1)),_initDefMessages(),!0):!1}function _selectInst(){var a=$("<div class='haf-list'></div>");$.each(_flowInsts,function(b,c){var d="<a href='"+CONTEXT_PATH+c.formId+(c.formId.indexOf("?")?"&":"?")+"instId="+c.id+"&dataId="+c.dataId+"' target='_self'>"+"提交人："+_getValue(c,"createrName")+"，"+"开始时间："+_getValue(c,"beginTime")+"，"+"结束时间："+_getValue(c,"endTime")+"</a>";a.append("<div class='haf-list-item'>"+d+"</div>")}),HAF.dialog({title:"当前数据在系统中存在多次审批记录，请选择查看",content:a})}function _selectTask(){var a=$("<div class='haf-list'></div>");$.each(_currentTasks,function(b,c){var d="<a href='"+_urls.task_redirect+"?taskUserId="+c.id+"' target='_self'>";d+="【"+c.nodeName+"】【"+c.beginTime+"】",c.authorized&&c.ownerId!=c.assignerId&&(d+="【"+c.ownerName+"（授权）】"),d+="</a>",a.append("<div class='haf-list-item'>"+d+"</div>")}),HAF.dialog({title:"当前流程中有多个需要您处理的任务，请选择处理",content:a})}function _jumpTo(a){var b="object"==typeof a?a:_oFlowNodes[a];b?(_disableButtons(),_setContext({targetNodeId:b.id}),$.get(_urls.get_node_user,{flowKeyId:_getIds("flowKeyId"),targetNodeId:b.id,instId:_getIds("instId")},function(a){b.assigners=a,_flowConfirm({nextNodes:[b],requires:{nextPerson:!1}})})):alert("未获取到驳回环节的配置信息")}function _appendTo(a){HAF.dialog("selectPsn",{deptLoad:_getCurrentDept(),success:function(b){var c=HAF.getKeyValue(b,"name",","),d=HAF.getKeyValue(b,"sysUsername",",");_setContext({appendAuthors:d,appendType:a}),_flowConfirm({displays:{nextNodeRow:!0},defaults:{nextPersonName:c,nextPersonUsername:d,operateName:_appendTypes[a]}})}})}function _classifyTo(a){HAF.ajax({url:_urls.classify,data:{taskUserId:_getIds("taskUserId"),classify:a},success:function(a){a&&a.success&&alert("分类标记完成")}})}function _reauthorizeTask(a,b){var b=b?"【"+b+"】":"";confirm("确定【"+_getButtonText()+"】"+b+"？")&&(_setContext("taskUserId",a),_commit())}function _command(a,b){var c,d;for(c=0;c<arguments.length;c++)"string"==typeof arguments[c]?b=arguments[c]:a=arguments[c];a||(a=$(".haf-flow-actions .haf-flow-button[haf-flow-action="+b+"]")),d=_commands[b],"function"==typeof d&&(_resetContext(b),d(a))}function _flowConfirm(a){var b=[],c={operateName:"",flowComment:"",flowMessage:""},d={flowComment:!0,flowMessage:!0,nextPerson:!0},e={nextPersonRow:!1,flowCommentRow:!1,flowMessageRow:!1,commentsAddRow:!0};a&&(a.nextNodes&&(b=a.nextNodes),a.defaults&&$.extend(c,a.defaults),a.requires&&$.extend(d,a.requires),a.displays&&$.extend(e,a.displays)),c.operateName||(c.operateName=_getButtonText()),c.flowMessage||(c.flowMessage=_getFlowMessage()),e.commentsAddRow=!e.flowCommentRow,b[0]&&_isEndNode(b[0].id)&&(e.nextPersonRow=!0,c.nextNodeName="结束"),_setNextNodes(b),HAF.dialog({key:"flow_cf",title:"请确认操作",content:HAF.Dialog.HTMLTemplate.flowConfirm,width:"620px",ready:function(a){var f,g;a.find("[haf-comp-id='nextNodeRow']:gt(0)").remove(),a.find("[haf-comp-id='nextPersonRow']:gt(0)").remove(),a.find("[haf-comp-id]").each(function(){var a=$(this).attr("haf-comp-id");e[a]?(d[a]=!1,$(this).hide()):$(this).show(),$(this).is("input:text,textarea")&&$(this).val(c[a]||"")}),e.nextPersonRow||(f=null,g=null,$.each(b,function(c,d){f?(f=f.clone().insertAfter(g),g=g.clone().insertAfter(f)):(f=a.find("div[haf-comp-id='nextNodeRow']"),g=a.find("div[haf-comp-id='nextPersonRow']")),f.find("label span").html("["+(c+1)+"]"),g.find("label span").html("["+(c+1)+"]"),f.find("input:first").val(d.name+(d.groupTask?"[任务池]":""));var e,h;d.groupTask&&(d.replacePerson=!1),d.assigners&&d.assigners.length?(e=HAF.getKeyValue(d.assigners,"sysUsername",","),h=HAF.getKeyValue(d.assigners,"name",","),""==h.replace(/,| /g,"")&&(h=e),g.find("input:first").val(d.groupTask?"[系统]":h),f.show(),g.show()):_isEndNode(d.id)?(d.replacePerson=0,f.hide(),g.hide()):(d.replacePerson=1,f.show(),g.show()),b.length<2&&(f||(f=a.find("div[haf-comp-id='nextNodeRow']"),g=a.find("div[haf-comp-id='nextPersonRow']")),f.find("label span").html(""),g.find("label span").html("")),d.replacePerson?(g.find("input[haf-comp-id='nextPersonName']").parent().removeClass().addClass("col-xs-6"),g.find("button[haf-comp-id='authorSelector']").unbind("click").click(function(){var a=$(this).parent().prev();HAF.dialog("selectPsn",{backdrop:!1,deptLoad:_getCurrentDept(),success:function(b){var c=HAF.getKeyValue(b,"name",","),d=HAF.getKeyValue(b,"sysUsername",",");a.find("input[haf-comp-id='nextPersonName']").val(c),a.find("input[haf-comp-id='nextPersonUsername']").val(d)}})}).parent().show()):(g.find("button[haf-comp-id='authorSelector']").parent().hide(),g.find("input[haf-comp-id='nextPersonName']").parent().removeClass().addClass("col-xs-8"))}),b.length||(a.find("button[haf-comp-id='authorSelector']").parent().hide(),a.find("input[haf-comp-id='nextPersonName']").parent().removeClass().addClass("col-xs-8"))),a.find("div[haf-comp-id='commentsAdd'] span").click(function(){a.find("div[haf-comp-id='commentsAddRow']").hide(),a.find("div[haf-comp-id='flowCommentRow']").show()}),a.find("div[haf-comp-id='tempComments'] span").click(function(){a.find("textarea[haf-comp-id='flowComment']").val($(this).text())})},success:function(c){var h,i,g=!0;return e.nextPersonRow||c.find("input[haf-comp-id='nextPersonUsername']").each(function(a,c){var e=c.value,f=$(c).prev().val();return!f&&d.nextPerson?(alert("请选择【"+$(this).parent().prev().text()+"】"),g=!1,!1):(e&&_setAssigner(b[a].id,e),void 0)}),g?(h=c.find("textarea[haf-comp-id='flowComment']"),i=h.val(),i||e.flowCommentRow||!d.flowComment?(_setContext("flowComment",i),h=c.find("input[haf-comp-id='flowMessage']"),i=h.val(),i||e.flowMessageRow||!d.flowMessage?(_setContext("flowMessage",i),c.modal("toggle"),"function"==typeof a.beforeOk&&a.beforeOk()===!1?!1:("submit"==_getOperateType()?_execute():_commit(),!1)):(alert("请填写【"+h.parent().prev().text()+"】"),!1)):(alert("请填写【"+h.parent().prev().text()+"】"),!1)):!1}})}function _communicate(){HAF.dialog({key:"comm_cr",title:"在线沟通",content:HAF.Dialog.HTMLTemplate.createComm,width:"620px",ready:function(a){a.find("input[haf-comp-id='subject']").val("关于“"+_flowBase.name+"”，请回复"),a.find("input[haf-comp-id='refId']").val(_getIds("instId")),a.find("input[haf-comp-id='refKey']").val(_getIds("nodeId")),a.find("button[haf-comp-id='replierSelector']").click(function(){var a=$(this).parent().prev();HAF.dialog("selectPsn",{backdrop:!1,deptLoad:_getCurrentDept(),singleSelect:!0,success:function(b){var c=HAF.getKeyValue(b,"name",","),d=HAF.getKeyValue(b,"sysUsername",",");a.find("input[haf-comp-id='replierName']").val(c),a.find("input[haf-comp-id='replierId']").val(d)}})})},success:function(a){var b={},c=!0;return a.find("input[haf-comp-id],textarea[haf-comp-id]").each(function(){var e=$(this).val();return!e&&$(this).is(":visible")?(alert("请选择或者填写【"+$(this).parent().prev().text()+"】"),c=!1,!1):(b[$(this).attr("haf-comp-id")]=e,void 0)}),c?(a.modal("toggle"),HAF.ajax({url:_urls.create_comm,data:b,success:function(a){a.success&&alert("沟通信息已发送，请等待回复")}}),!1):!1}})}function _parseProcessVar(){if("function"==typeof _options.parseProcessVar){var a=_options.parseProcessVar();"object"==typeof a&&HAF.setKeyValue(_flowContext.processVar,a)}}function _parseSubProcessVar(){if("function"==typeof _options.parseSubProcessVar){var a=_options.parseSubProcessVar();"object"==typeof a&&HAF.setKeyValue(_flowContext.subProcessVar,a)}}function _parseBizData(){if("function"==typeof _options.parseBizData){var a=_options.parseBizData();"object"==typeof a&&HAF.setKeyValue(_bizData,a)}}function _parseAllData(){_parseProcessVar(),_parseSubProcessVar(),_parseBizData()}function _commit(){var c,a=_getOperateType(),b="on"+a.replace(/^[a-z]/,function(a){return a.toUpperCase()});return"function"==typeof _options[b]&&(c=_options[b](),"boolean"==typeof c&&0==c)?!1:(_parseAllData(),"submit"==a?$.post(_urls.get_next_node,_flowContext,function(a){_flowConfirm({nextNodes:a,requires:{flowComment:!_isFirstNode()},displays:{flowCommentRow:_isFirstNode()}})}):_execute(),void 0)}function _execute(){if("function"==typeof _options.beforeCommit){var a=_options.beforeCommit(_nextNodes);if("boolean"==typeof a&&0==a)return!1}HAF.ajax({url:_urls.submit,contentType:"application/json",data:HAF.stringify({flowContext:_flowContext,bizData:_bizData}),success:function(a){a&&a.success?(alert("流程【"+_getButtonText()+"】成功！"),"function"==typeof _options.afterCommit&&_options.afterCommit(),HAF.closeWindow()):alert("流程操作失败！错误原因："+a.error)}})}var _ids,_currentUsername,_currentDate,_currentPerson,_flowBase,_flowInst,_currentNode,_currentTask,_flowNodes,_nodeButtons,_currentNodes,_currentTasks,_flowInsts,_authorizedTasks,_isTaskPool,_isClaimedTask,_oFlowNodes,_oNodeButtons,_flowHiTasks,_flowHiActions,_flowHiNodes,_flowHiComments,_flowContext,_bizData,_nextNodes,_isMyAuthorized,_isNewFlow,_reject_menu_init,_append_menu_init,_jump_menu_init,_hangup_menu_init,_classify_menu_init,_reauthorize_menu_init,_urls,_options,_buttons,_buttons_def,_buttons_new,_appendTypes,_classifyList,_classify_hangup,_messages,_commands;window.HAF&&(window.HAF.Flow||(window.HAF.Flow={}),_ids={flowDefId:"",flowKeyId:"",instId:"",taskUserId:"",dataId:"",nodeId:"",formId:"",executionId:""},_currentUsername="",_currentDate="",_currentPerson=null,_flowBase=null,_flowInst=null,_currentNode=null,_currentTask=null,_flowNodes=null,_nodeButtons=null,_currentNodes=null,_currentTasks=null,_flowInsts=null,_authorizedTasks=null,_isTaskPool=!1,_isClaimedTask=!1,_oFlowNodes=null,_oNodeButtons=null,_flowHiTasks=null,_flowHiActions=null,_flowHiNodes=null,_flowContext={assigners:{},processVar:{},subProcessVar:{}},_bizData={},_nextNodes=null,_isMyAuthorized=!1,_isNewFlow=!0,_reject_menu_init=!1,_append_menu_init=!1,_jump_menu_init=!1,_hangup_menu_init=!1,_classify_menu_init=!1,_reauthorize_menu_init=!1,_urls={init:"/flow/init.do",submit:"/flow/submit.do",view:"/flow/view/img.do",get_node:"/flow/getFlowNodes.do",get_next_node:"/flow/getNextNode.do",get_node_user:"/flow/getNodeUser.do",get_history:"/flow/getHistory.do",get_hi_node:"/flow/getNodeHistory.do",get_hi_task:"/flow/getTaskHistory.do",get_hi_action:"/flow/getActionHistory.do",single_claim:"/flow/singleClaim.do",classify:"/flow/classify.do",task_redirect:"/flow/userTask/redirect.do",create_comm:"/oa/user/comm/create.do",get_comm:"/oa/user/comm/my/get.do",flow_confirm_jsp:"/html/haf/dialog/flow-confirm.html",flow_comm_jsp:"/html/haf/dialog/comm-create.html"},_options={ids:{},submitUrl:"",startNode:"StartEvent",endNode:"EndEvent",firstNode:"FirstNode",lastNode:"LastNode",beforeCommit:null,afterCommit:null,parseProcessVar:null,parseSubProcessVar:null,parseBizData:null},_buttons={quit:{key:"quit",text:"退出",clsClass:"btn-info"},save:{key:"save",text:"保存",clsClass:"btn-primary"},submit:{key:"submit",text:"提交",clsClass:"btn-success",confirm:!0},reject:{key:"reject",text:"驳回",clsClass:"btn-warning",hasMenu:!0,confirm:!0},append:{key:"append",text:"加签",clsClass:"btn-info",hasMenu:!0},handover:{key:"handover",text:"转办",clsClass:"btn-info"},revoke:{key:"revoke",text:"撤签",clsClass:"btn-info"},notify:{key:"notify",text:"通知",clsClass:"btn-info"},deliver:{key:"deliver",text:"传阅",clsClass:"btn-info"},authorize:{key:"authorize",text:"授权",clsClass:"btn-info"},reauthorize:{key:"reauthorize",text:"收回授权",clsClass:"btn-info"},claim:{key:"claim",text:"认领",clsClass:"btn-info"},backpool:{key:"backpool",text:"退回任务池",clsClass:"btn-info"},hangup:{key:"hangup",text:"挂起",clsClass:"btn-info"},classify:{key:"classify",text:"归类",clsClass:"btn-info",hasMenu:!0},communicate:{key:"communicate",text:"沟通",clsClass:"btn-info"},jump:{key:"jump",text:"跳转",clsClass:"btn-warning",hasMenu:!0,confirm:!0},replace:{key:"replace",text:"替换",clsClass:"btn-warning"},stop:{key:"stop",text:"终止",clsClass:"btn-warning"},manage:{key:"manage",text:"权限管理",clsClass:"btn-warning"},print:{key:"print",text:"打印",clsClass:"btn-info"},view:{key:"view",text:"查看流程",clsClass:"btn-info"}},_buttons_def=["quit","print","view"],_buttons_new=["save","submit"],_appendTypes={before:"加签到我之前",current:"加签与我会签",after:"加签到我之后"},_classifyList=[{name:"important",text:"重要任务"},{name:"normal",text:"普通任务"},{name:"issue",text:"问题任务"}],_classify_hangup="[HANGUP]",_messages={},_commands={quit:function(){confirm("确定【"+_getButtonText()+"】页面？（请注意保存您的修改记录）")&&HAF.closeWindow()},save:function(){confirm("确定【"+_getButtonText()+"】？")&&_commit()},submit:function(){_disableButtons(),_commit()},reject:function(a){var d,b=_getButtonValue(),c=[];"[toPreNode]"==b?c.push(_flowHiNodes[_flowHiNodes.length-1]):"[toAnyNode]"==b?c=_flowHiNodes:b&&"[toStart]"!=b?c=b.split(","):c.push(_flowNodes[0]),1==c.length?_jumpTo(c[0]):c.length>1&&(_reject_menu_init||null==a||(d=$('<ul class="dropdown-menu"></ul>'),a.addClass("dropdown-toggle").after(d),d.empty(),$.each(c,function(a,b){d.append("<li haf-flow-action='"+b+"'><a href='javascript:void(0)'><span>到："+_oFlowNodes[b].name+"</span></a></li>")
}),d.find("li").click(function(){_jumpTo($(this).attr("haf-flow-action"))}),_reject_menu_init=!0,a.attr("data-toggle","dropdown")))},append:function(a){var d,b=_getButtonValue()||"before;current;after",c=b.split(";");1==c.length?_appendTo(c[0]):!_append_menu_init&&a&&(d=$('<ul class="dropdown-menu"></ul>'),a.addClass("dropdown-toggle").after(d),d.empty(),$.each(c,function(a,b){var c=$('<li><a href="javascript:void(0)"><span>'+_appendTypes[b]+"</span></a></li>");d.append(c),c.click(function(){_appendTo(b)})}),_append_menu_init=!0,a.attr("data-toggle","dropdown"))},handover:function(){HAF.dialog("selectPsn",{singleSelect:!0,deptLoad:_getCurrentDept(),success:function(a){var b=HAF.getKeyValue(a,"name",","),c=HAF.getKeyValue(a,"sysUsername",",");_setContext({newAssigner:c}),_flowConfirm({displays:{nextNodeRow:!0},defaults:{nextPersonName:b,nextPersonUsername:c}})}})},revoke:function(){confirm("确定【"+_getButtonText()+"】")&&_commit()},notify:function(){HAF.dialog("selectPsn",{deptLoad:_getCurrentDept(),success:function(a){var b=HAF.getKeyValue(a,"name",","),c=HAF.getKeyValue(a,"sysUsername",",");_flowConfirm({displays:{flowCommentRow:!0,nextNodeRow:!0},defaults:{nextPersonName:b,nextPersonUsername:c}})}})},deliver:function(){HAF.dialog("selectPsn",{deptLoad:_getCurrentDept(),success:function(a){var b=HAF.getKeyValue(a,"name",","),c=HAF.getKeyValue(a,"sysUsername",",");_flowConfirm({displays:{flowCommentRow:!0,nextNodeRow:!0},defaults:{nextPersonName:b,nextPersonUsername:c}})}})},authorize:function(){HAF.dialog("selectPsn",{deptLoad:_getCurrentDept(),singleSelect:!0,success:function(a){var b=HAF.getKeyValue(a,"name",","),c=HAF.getKeyValue(a,"sysUsername",",");_setContext({authorAssigner:c}),_flowConfirm({displays:{flowCommentRow:!0,nextNodeRow:!0},defaults:{nextPersonName:b,nextPersonUsername:c}})}})},reauthorize:function(a){var b,c;_currentTask?(b=_currentTask.assignerName+"["+_currentTask.nodeName+"]",_reauthorizeTask(_currentTask.id,b)):!_reauthorize_menu_init&&a&&(c=$('<ul class="dropdown-menu"></ul>'),a.addClass("dropdown-toggle").after(c),c.empty(),$.each(_authorizedTasks,function(a,b){var d=b.assignerName+"["+b.nodeName+"]",e=$("<li><a href='javascript:void(0)'><span>"+d+"</span></a></li>");c.append(e),e.click(function(){_reauthorizeTask(b.id,d)})}),_reauthorize_menu_init=!0,a.attr("data-toggle","dropdown"))},claim:function(){confirm("确定【"+_getButtonText()+"】？")&&HAF.ajax({url:_urls.single_claim,data:{taskUserId:_getIds("taskUserId")},success:function(a){a&&a.success&&(alert("认领成功，流程将重新加载，请稍后"),self.location.reload())}})},hangup:function(){confirm("确定【"+_getButtonText()+"】？")&&(_setContext("classify",_classify_hangup),_commit())},backpool:function(){confirm("确定【"+_getButtonText()+"】？")&&_commit()},classify:function(a){if(!_classify_menu_init&&a){var b=$('<ul class="dropdown-menu"></ul>');a.addClass("dropdown-toggle").after(b),b.empty(),$.each(_classifyList,function(a,c){var d=$("<li><a href='javascript:void(0)'><span>"+c.text+"</span></a></li>");b.append(d),d.click(function(){_classifyTo(c.name)})}),_classify_menu_init=!0,a.attr("data-toggle","dropdown")}},communicate:function(){_communicate()},jump:function(a){var b,c,d;!_jump_menu_init&&a&&(b=_getButtonValue()||"",c=b.split(";"),d=$('<ul class="dropdown-menu"></ul>'),a.addClass("dropdown-toggle").after(d),d.empty(),b&&c.length>0?$.each(c,function(a,b){var c=$("<li><a href='javascript:void(0)'><span>到："+_getNodeValue(b,"name")+"</span></a></li>");d.append(c),c.click(function(){_jumpTo(b)})}):$.each(_oFlowNodes,function(a,b){var c=$("<li><a href='javascript:void(0)'><span>到："+b.name+"</span></a></li>");d.append(c),c.click(function(){_jumpTo(a)})}),_jump_menu_init=!0,a.attr("data-toggle","dropdown"))},replace:function(){HAF.dialog("selectPsn",{deptLoad:_getCurrentDept(),singleSelect:!0,success:function(a){var b=HAF.getKeyValue(a,"name",","),c=HAF.getKeyValue(a,"sysUsername",",");_setContext({newAssigner:c}),_flowConfirm({displays:{flowCommentRow:!0,nextNodeRow:!0},defaults:{nextPersonName:b,nextPersonUsername:c}})}})},stop:function(){confirm("确定【"+_getButtonText()+"】？")&&_commit()},manage:function(){},print:function(){alert("为了更好的打印效果，建议使用浏览器的【文件】【打印预览】功能"),window.print()},view:function(){HAF.dialog({key:"flow_view",title:"流程查看",content:"",forceInit:!1,width:"800px",backdrop:!0,ready:function(a){var b='<div class="flow-hi-view"><ul class="nav nav-tabs"><li class="active"><a href="#_flow_view_img" flow-hi-type="img">流程图</a></li><li><a href="#_flow_hi_sub_flow" flow-hi-type="sub">子流程</a></li><li><a href="#_flow_hi_node" flow-hi-type="node">流转记录</a></li><li><a href="#_flow_hi_action" flow-hi-type="action">操作记录</a></li><li><a href="#_flow_hi_task" flow-hi-type="task">任务记录</a></li><li><a href="#_flow_hi_comm" flow-hi-type="comm">沟通记录</a></li><li><a href="#_flow_hi_comment" flow-hi-type="comment">批示意见</a></li></ul><div class="tab-content"><div class="tab-pane active" id="_flow_view_img"></div><div class="tab-pane" id="_flow_hi_sub_flow"></div><div class="tab-pane" id="_flow_hi_node"></div><div class="tab-pane" id="_flow_hi_action"></div><div class="tab-pane" id="_flow_hi_task"></div><div class="tab-pane" id="_flow_hi_comm"></div><div class="tab-pane" id="_flow_hi_comment"></div></div></div>';a.find(".modal-body").html(b),a.find(".nav li a").attr("data-toggle","tab").click(function(){var e,f,b=$(this).attr("href"),c=a.find(b),d=$(this).attr("flow-hi-type");""==c.html()&&(e=$('<div class="loading-img"></div>'),e.appendTo(c),"img"==d?$('<img src="'+_urls.view+"?"+HAF.urlSerialize(_ids)+'" style="display:none">').load(function(){e.remove(),c.css("text-align","center").find("img").show()}).appendTo(c):"comment"==d?(e.remove(),f=$('<table class="table flow-hi-table"></table>'),f.append("<thead><tr><td>处理人</td><td>处理环节</td><td>处理类型</td><td>处理时间</td></tr></thead>"),$.each(_flowHiComments,function(a,b){f.append('<tr class="flow-user-row"><td>'+_getValue(b,"operaterName")+"</td>"+"<td>"+_getValue(b,"nodeName")+"</td>"+"<td>"+_getButtonText(_getValue(b,"operateType"))+"</td>"+"<td>"+_getValue(b,"operateTime")+"</td>"+"</tr>"+'<tr class="flow-comment-row"><td colspan="4">'+_getValue(b,"opinion")+"</td></tr>")}),f.appendTo(c)):_isNewFlow?c.html("<p>未查询到相关记录</p>"):$.get(_urls.get_history,{instId:_getIds("instId"),hiType:d},function(a){if(e.remove(),a&&a.length){var b=$('<table class="table flow-hi-table"></table>');"node"==d?(b.append("<thead><tr><td>流程环节</td><td>环节类型</td><td>开始时间</td><td>结束时间</td></tr></thead>"),$.each(a,function(a,c){_getValue(c,"nodeName")&&b.append('<tr class=""><td>'+_getValue(c,"nodeName")+"</td>"+"<td>"+_getValue(c,"nodeType")+"</td>"+"<td>"+_getValue(c,"nodeBeginTime")+"</td>"+"<td>"+_getValue(c,"nodeEndTime")+"</td>"+"</tr>")})):"action"==d?(b.append("<thead><tr><td>操作时间</td><td>操作人</td><td>操作类型</td><td>操作环节</td><td>流向环节</td></tr></thead>"),$.each(a,function(a,c){b.append("<tr><td>"+_getValue(c,"operateTime")+"</td>"+"<td>"+_getValue(c,"operaterName")+"</td>"+"<td>"+_getButtonText(_getValue(c,"operateType")||"-")+"</td>"+"<td>"+_getValue(c,"nodeName")+"</td>"+"<td>"+_getValue(c,"flowNodeName")+"</td>"+"</tr>")})):"task"==d?(b.append("<thead><tr><td>任务环节</td><td>开始时间</td><td>完成时间</td><td>预定处理人</td><td>实际处理人</td></tr></thead>"),$.each(a,function(a,c){b.append("<tr><td>"+_getValue(c,"nodeName")+"</td>"+"<td>"+_getValue(c,"beginTime")+"</td>"+"<td>"+_getValue(c,"endTime")+"</td>"+"<td>"+_getValue(c,"preAssignerName")+"</td>"+"<td>"+_getValue(c,"realAssignerName")+"</td>"+"</tr>")})):"comm"==d&&(b.append("<thead><tr><td>处理人</td><td>处理环节</td><td>操作类型</td><td>处理时间</td></tr></thead>"),$.each(a,function(a,c){var d=_getNodeValue([c.refKey],"name");b.append('<tr class="flow-user-row"><td>'+_getValue(c,"creatorName")+"</td>"+"<td>"+d+"</td><td>发起</td>"+"<td>"+_getValue(c,"createDate")+"</td>"+"</tr>"+'<tr class="flow-comment-row"><td colspan="4">'+_getValue(c,"content")+"</td></tr>"),_getValue(c,"replyDate")&&b.append('<tr class="flow-user-row"><td>'+_getValue(c,"replierName")+"</td>"+"<td>"+d+"</td><td>答复</td>"+"<td>"+_getValue(c,"replyDate")+"</td>"+"</tr>"+'<tr class="flow-comment-row"><td colspan="4">'+_getValue(c,"replyContent")+"</td></tr>")})),c.append(b)}else c.html("<p>未查询到相关记录</p>")}))}).first().click()}})}},$.extend(window.HAF.Flow,{init:function(a){_init(a)},command:function(a){_command(a)},commit:function(){_commit()},initContext:function(){_initContext()},setContext:function(a,b){_setContext(a,b)},resetContext:function(){_resetContext()},isStartNode:function(a){return _isStartNode(a)},isFirstNode:function(a){return _isFirstNode(a)},isEndNode:function(a){return _isEndNode(a)},setIds:function(a,b){_setIds(a,b)},getIds:function(a){return _getIds(a)},getOperateType:function(){return _getOperateType()},getButtonText:function(a){return _getButtonText(a)},setOperateType:function(a){_setOperateType(a)},getCurrentPerson:function(){return _getCurrentPerson()},getCurrentDate:function(){return _getCurrentDate()},getCurrentDept:function(){return _getCurrentDept()},getCurrentNode:function(){return _getCurrentNode()},getFlowBase:function(){return _getFlowBase()},getFlowNodes:function(){return _getFlowNodes()},setProcessVar:function(a,b){_setProcessVar(a,b)},setSubProcessVar:function(a,b){_setSubProcessVar(a,b)},getNextNodes:function(){return _getNextNodes()},setAssigner:function(a,b){_setAssigner(a,b)},setBizData:function(a,b){_setBizData(a,b)}}))}(window,void 0,jQuery),function(window,undefined,$){function _fileUpload(success,error,selectType){var singleSelect,upload_url,download_url,list_url,class_list_url,target,html;success=success||function(){},error=error||function(a){alert(a)},singleSelect=selectType&&"single"==selectType,_file_uploader||(_file_uploader="_"+(new Date).getTime()),upload_url=HAF.basePath()+"/oa/user/attach/upload.do",download_url=HAF.basePath()+"/oa/user/attach/download.do",list_url=HAF.basePath()+"/oa/user/attach/list.do",class_list_url=HAF.basePath()+"/oa/user/attach/classList.do",target="_haf_upload_iframe"+_file_uploader,html='<ul class="nav nav-tabs"><li class="active"><a href="#upload_tab'+_file_uploader+'" data-toggle="tab">文件上传</a></li>'+'<li><a href="#att_list_tab'+_file_uploader+'" data-toggle="tab">我的附件库</a></li>'+"</ul>"+'<div class="tab-content">'+'<div class="tab-pane active" id="upload_tab'+_file_uploader+'">'+'<iframe name="'+target+'" style="display:none;"></iframe>'+'<form method="post" enctype="multipart/form-data" target="'+target+'" action="'+upload_url+'">'+'<div style="width:100%;padding:20px 10px 40px 10px">'+'<input type="file" name="file" style="width:50%;float:left">'+'<div style="float:right;width:250px;">文件分类：<input type="text" name="classify" style="width:200px;"></div>'+"</div>"+"</form>"+"</div>"+'<div class="tab-pane active" id="att_list_tab'+_file_uploader+'">'+"</div>"+"</div>",HAF.dialog({key:_file_uploader,title:"附件上传",content:html,forceInit:!0,width:"650px",ready:function($d){$d.find("iframe").unbind().bind("load",function(){var data,doc=$d.find("iframe")[0].contentDocument||$d.find("iframe")[0].contentWindow.document,str=doc.body.innerHTML;if(str.replace(/ |\r|\n/,""))try{data=eval("("+str+")"),data&&(data.success?(success(data.data),$d.modal("toggle")):error(data.msg))}catch(e){error("系统错误，操作失败")}}),$d.find(".nav-tabs a:first").click(function(){$d.find("#att_classes"+_file_uploader).hide()}),$d.find(".nav-tabs a:last").click(function(){var b,a=$("#att_list_tab"+_file_uploader);""==a.html()&&(b='<div style="width:100%;height:230px"><table id="att_list'+_file_uploader+'"></table></div>',a.append(b),b='<select id="att_classes'+_file_uploader+'"'+' style="min-width:120px;max-width:200px;position:absolute;right:20px;top:12px;display:none">'+'<option value="">** 类型筛选 **</option>'+'<option value="[NULL]">** [未分类] **</option>'+"</select>",$d.find(".modal-body").append(b),$("#att_list"+_file_uploader).datagrid({fit:!0,striped:!0,method:"POST",rownumbers:!0,pageSize:15,pagination:!0,pageList:[5,15,30,50],border:!1,fitColumns:!0,checkbox:!0,singleSelect:singleSelect,url:list_url,idField:"id",columns:[[{field:"id",checkbox:!0},{field:"originalName",title:"文件名称",width:200,align:"center"},{field:"createDate",title:"上传时间",width:120,align:"center"},{field:"extType",title:"类型",width:60,align:"center"},{field:"fileSize",title:"大小",width:60,align:"center"},{field:"classify",title:"分类",width:80,align:"center"},{field:"_action",title:"#",width:60,align:"center",formatter:function(a,b){return"<a target='_blank' href='"+download_url+"?id="+b.id+"' style='color:#3333CC;'>查看</a>"}}]]}),$.get(class_list_url+"?t"+(new Date).getTime(),"",function(a){if(a.length){var b="";$.each(a,function(a,c){b+='<option value="'+c+'">'+c+"</option>"}),$("#att_classes"+_file_uploader).append(b)}$("#att_classes"+_file_uploader).unbind().change(function(){$("#att_list"+_file_uploader).datagrid("load",{classify:$(this).val()})})})),$d.find("#att_classes"+_file_uploader).show()})},success:function(a){if(a.find(".nav-tabs li:first").is(".active"))return""==a.find("#upload_tab"+_file_uploader+" input:file").val()?alert("请选择上传的文件"):a.find("#upload_tab"+_file_uploader+" form")[0].submit(),!1;var b=$("#att_list"+_file_uploader).datagrid("getSelections");return b.length?(success(b),void 0):(alert("请选择需要的文件"),!1)}})}function _setReadonly(a,b){var d,c=$(a);d=b?c.find(b):c.find("input:text,:radio,:checkbox,select,textarea").filter(":visible"),d.each(function(){$(this).is(":text,textarea")?this.readOnly=!0:this.disabled=!0})}function _formToJson(a){var b={},c=$(a);return c.size()>0&&(c.find("input:text,input:hidden,select,textarea").filter("[name]:enabled").each(function(){b[this.name]=$(this).val()}),c.find("input:checked").each(function(){$(this).is(":checkbox")?(b[this.name]||(b[this.name]=[]),b[this.name].push($(this).val())):b[this.name]=$(this).val()})),b}function _setDatepicker(a){var a=a||"form .date-input";$(a).attr("readonly","readonly").each(function(){var a=$(this).parent(),b=$('<div class="input-group"></div>');a.append(b).addClass("date-input-group"),$(this).appendTo(b),b.append('<span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>'),a.datepicker()})}function _setInputSelect(a){var a=a||"form .select-input";$(a).hide().each(function(){var a=$(this),b=this.id,c=!1;b&&(c=$("select[haf-comp-for='"+b+"']")),!c&&a.next().is("select")&&(c=a.next()),c&&c.val(a.val()).change(function(){a.val($(this).val())}).show()})}if(window.HAF){HAF.Form||(HAF.Form={});var _file_uploader="";$.extend(window.HAF.Form,{fileUpload:function(a,b,c){_fileUpload(a,b,c)},readonly:function(a,b){_setReadonly(a,b)},datepicker:function(a){_setDatepicker(a)},inputSelect:function(a){_setInputSelect(a)}})}}(window,void 0,jQuery);