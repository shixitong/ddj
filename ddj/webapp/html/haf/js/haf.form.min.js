(function(n,d,j){if(!n.CONTEXT_PATH){n.CONTEXT_PATH="/haf"}if(!n.HAF){n.HAF={}}var a=CONTEXT_PATH;function f(s){var r=typeof(s)=="object"?Object.prototype.toString.call(s):typeof(s);switch(r){case"[object Array]":return"array";case"[object Object]":return"object";case"[object Date]":return"date";default:return r}}function e(v){var r=[];var u=f(v)=="array";var s=function(w){if(typeof w=="object"&&w!=null){return e(w)}return/^(string)$/.test(typeof w)?'"'+w.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"')+'"':w};switch(f(v)){case"array":u=true;break;case"object":u=false;break;case"date":return s(v.toString());case"function":return"'function'";default:return s(v)}for(var t in v){if(u){r.push(s(v[t]))}else{r.push('"'+t+'":'+s(v[t]))}}return u?("["+r.join(",")+"]"):("{"+r.join(",")+"}")}function h(s){var r="";if(f(s=="object")){j.each(s,function(u,t){if(f(t)=="object"){j.each(t,function(w,v){r+="&"+u+"."+w+"="+encodeURIComponent(v)})}else{if(f(t)=="array"){j.each(t,function(v,w){r+="&"+u+"="+encodeURIComponent(w)})}else{r+="&"+u+"="+encodeURIComponent(t)}}})}return r.replace(/^\&+/,"")}function p(r){var v,A,s,t;if(f(r)=="object"){var x=j.extend({show:true,showFront:false,backdrop:false,frontTxt:""},r);v=x.show,A=x.showFront,s=x.backdrop,t=x.frontTxt}else{var x=[true,false,false,""];var y=0;for(var w=0;w<arguments.length;w++){if(typeof arguments[w]=="boolean"){x[y++]=arguments[w]}else{x[3]=arguments[w]}}v=x[0],A=x[1],s=x[2],t=x[3];if(x[3]){A=true}}var z=j(".haf-body-mask");var u=j(document.body);if(!v){if(z.size()>0){z.hide();u.removeClass("haf-mask-show")}return}u.addClass("haf-mask-show");if(z.size()==0){z=j("<div class='haf-body-mask'><div class='haf-body-mask-front'></div><div class='haf-body-mask-back'></div></div>");u.append(z)}if(A){z.find(".haf-body-mask-front").html("<div class='haf-mask-msg'><div class='haf-mask-msg-inner'>"+t+"</div></div>")}else{z.find(".haf--mask-msg").remove()}if(s){z.unbind("click").click(function(){p(false)})}z.show()}var c=0;j.ajaxSetup({error:function(t,r,s){if(t.status==200&&t.responseText){alert(t.responseText)}else{if(t.status==0){}else{alert("系统错误："+r+" - "+s)}}}});function l(r){var r=j.extend({type:"POST",async:"true",dataType:"json",backdrop:true,beforeSend:function(){if(c==0){p("请稍后...")}c++},complete:function(){c--;if(c==0){p(false)}}},r);if(!r.backdrop&&c==0){c=1}j.ajax(r)}function i(){try{n.open("","_parent","");n.close();if(n){n.location="about:blank"}}catch(r){n.location="about:blank"}}function k(x,s,w){var w=arguments.length>=2?w:d;if(!s||!x){return w}try{var s=s.split(".");var r=x[s[0]];for(var t=1;t<s.length;t++){r=r[s[t]]}if(typeof r=="undefined"){r=w}return r}catch(u){return w}}function g(w,t,s){if(!t||!w){return}if(typeof t=="object"){if(s==true){j.extend(true,w,t)}else{j.extend(w,t)}}else{var t=t.split(".");var u=0;var r=function(v,x){if(u<t.length-1){if(typeof v[t[u]]!="object"){v[t[u]]={}}u++;r(v[t[u-1]],x)}else{v[t[u]]=x}};r(w,s)}}function b(s,u,t){if(f(s)=="array"){var v=[];j.each(s,function(w,r){v.push(k(r,u,""))});if(typeof t=="boolean"&&t==true){return v}else{if(!t){t=","}return v.join(t)}}else{return k(s,u,"")}}function m(s){if(s==""||s==null||typeof s=="undefined"){return true}if(f(s)=="array"&&s.length==0){return true}if(f(s)=="object"){for(var r in s){return false}return true}return false}function q(s,r){if(!r){r=" "}return s.replace(new RegExp("^"+r+"+|"+r+"+$","gi"),"")}function o(s,r){if(!r){r=" "}return s.replace(new RegExp(r+r+"+","gi"),r).replace(new RegExp("^"+r+"+|"+r+"+$","gi"),"")}j.extend(n.HAF,{basePath:function(r){if(arguments.length>0){a=r}else{return a}},stringify:function(r){return e(r)},dataType:function(r){return f(r)},urlSerialize:function(r){return h(r)},closeWindow:function(){i()},showMask:function(r){p(r)},ajax:function(r){l(r)},getValue:function(u,r,t){return k(u,r,t)},setValue:function(t,s,r){g(t,s,r)},getListValue:function(u,r,t){return b(u,r,t)},isEmpty:function(r){return m(r)},trim:function(r,t){return q(r,t)},trimRepeat:function(r,t){return o(r,t)}})})(window,undefined,jQuery);(function(a,d,c){function b(){var k=[true,false,false,""];var l=0;for(var j=0;j<arguments.length;j++){if(typeof arguments[j]=="boolean"){k[l++]=arguments[j]}else{k[3]=arguments[j]}}var h=k[0],m=k[1],f=k[2],e=k[3];if(k[3]){m=true}var n=c(".haf-body-mask");var g=c(document.body);if(!h){if(n.size()>0){n.hide();g.removeClass("haf-mask-show")}return}g.addClass("haf-mask-show");if(n.size()==0){n=c("<div class='haf-body-mask'><div class='haf-body-mask-front'></div><div class='haf-body-mask-back'></div></div>");g.append(n)}if(m){n.find(".haf-body-mask-front").html("<div class='haf-mask-msg'><div class='haf-mask-msg-inner'>"+(e||"")+"</div></div>")}else{n.find(".haf--mask-msg").remove()}if(f){n.unbind("click").click(function(){HAF.showMask(false)})}n.show()}if(!a.HAF){a.HAF={}}c.extend(a.HAF,{showMask:function(){b()}})})(window,undefined,jQuery);(function(h,e,g){if(!h.HAF){return}if(!h.HAF.Dialog){h.HAF.Dialog={}}g(document).off("hidden.bs.modal",".modal").on("hidden.bs.modal",".modal",function(){if(g(document.body).find("div.modal-backdrop").size()==0){g(document.body).removeClass("modal-open")}});var b="/oa/service/comorg/getOrgChildren.do";var l="/oa/service/comorg/getPersonList.do";var d="/oa/service/comorg/getOrgAllChildren.do";var k="/oa/service/comorg/getOrgPositions.do";var n;var j=1000;var i={};function a(q){var u;var q=g.extend({backdrop:"static",title:"&nbsp;",content:"&nbsp;",width:"650px",forceInit:true},q);var s="_haf_dialog_";var t=function(){if(q.title){u.find(".modal-title").empty().append(q.title)}if(q.content){u.find(".modal-body").empty().append(q.content)}if(typeof q.ready=="function"){u.on("shown.bs.modal",function(v){q.ready(u)})}if(typeof q.success=="function"){u.find(".btn-primary").unbind("click").click(function(){var v=q.success(u);if(!(typeof v=="boolean"&&v==false)){u.modal("toggle")}})}};if(q.key){s+=q.key;u=g("#"+s);if(u.size()>0){u.off("shown.bs.modal");if(q.forceInit){t()}u.modal("toggle");if(q.backdrop){u.data("bs.modal").$backdrop.css("z-index",j++)}u.data("bs.modal").$element.css("z-index",j++);return u}}else{s+=(new Date()).getTime()}var r='<div id="'+s+'" class="modal fade" data-backdrop="'+q.backdrop+'"><div class="modal-dialog haf-dialog" style="width:'+q.width+'"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title"></h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">关&nbsp;闭</button>'+(typeof q.success=="function"?'<button type="button" class="btn btn-primary">确&nbsp;定</button>':"")+"</div></div></div></div>";u=g(r);u.appendTo("body");t();u.modal("toggle");if(q.backdrop){u.data("bs.modal").$backdrop.css("z-index",j++)}u.data("bs.modal").$element.css("z-index",j++);return u}function o(A){var C=g.extend({key:"",backdrop:"static",rootId:"O00000001",rootSelect:true,deptLoad:"",defaultMyDept:true,singleSelect:false},A);var w={};var z=HAF.basePath()+b;var y=HAF.basePath()+l;if(!C.deptLoad){C.deptLoad=C.rootId}var x,u,B,q,v,t,s;var r=-1;return a({key:"psn_sel_"+C.key,title:"人员选择",content:n.selectPsn,backdrop:C.backdrop,width:"750px",ready:function(D){x=D.find("div[haf-comp-id='deptTree'] ul");u=D.find("div[haf-comp-id='deptTreeBtns'] .dropdown-menu li");B=D.find("div[haf-comp-id='personList'] table");q=D.find("div[haf-comp-id='personSelected']");v=D.find("div[haf-comp-id='personSelectedBtns']");t=D.find(".grid-select-param input:text");s=D.find(".grid-select-param .btn");x.tree({lines:true,url:z+"?orgId="+C.rootId+"&getSelf=true",onBeforeExpand:function(E){x.tree("options").url=z+"?getSelf=false&orgId="+E.id},onSelect:function(E){t.val("");B.datagrid("load",{deptId:E.id,myDept:false})}});if(C.rootSelect){u.parent().prev().css("visibility","visible")}else{u.parent().prev().css("visibility","hidden")}u.click(function(){var E=x.tree("getRoot");var F=g(this).index();var G="";if(F==0&&E.id!="O00000001"){G=z+"?orgId=O00000001&getSelf=true"}else{if(F==1&&E.id!="O00000001"){G=z+"?orgId="+E.id+"&getSelf=true&getParent=true"}else{if(F==2&&F!=r){G=z+"?orgId="+C.deptLoad+"&getSelf=true&myDept=true"}}}if(G){g.get(G+"&t"+(new Date()).getTime(),"",function(H){x.tree({url:null,data:H});E=x.tree("getRoot");if(E!=null){x.tree("select",E.target)}})}});B.datagrid({fit:true,striped:true,rownumbers:true,pageSize:15,pagination:true,pageList:[5,15,30,50],border:false,singleSelect:C.singleSelect,url:y+"?t"+(new Date()).getTime(),queryParams:{deptId:C.deptLoad,myDept:C.defaultMyDept},idField:"id",frozenColumns:[[{field:"id",checkbox:true},{field:"name",title:"姓名",width:70,align:"center"},{field:"empNumber",title:"工号",width:70,align:"center"}]],columns:[[{field:"positionName",title:"职位",width:120,align:"center"},{field:"departmentName",title:"部门",width:120,align:"center"},{field:"officePhone",title:"办公电话",width:100,align:"center"},{field:"mobile",title:"移动长号",width:100,align:"center"}]],onSelect:function(G,F){var E=q.find("span[dataId='"+F.id+"']");if(E.size()==0){if(C.singleSelect){q.children().remove();w={}}q.append("<span dataId='"+F.id+"'>"+F.name+"["+F.empNumber+"]</span>");w[F.id]=F}},onUnselect:function(G,F){var E=q.find("span[dataId='"+F.id+"']");if(E.size()>0){E.remove()}},onSelectAll:function(E){g.each(E,function(H,G){var F=q.find("span[dataId='"+G.id+"']");if(F.size()==0){q.append("<span dataId='"+G.id+"'>"+G.name+"["+G.empNumber+"]</span>");w[G.id]=G}})},onUnselectAll:function(E){g.each(E,function(H,G){var F=q.find("span[dataId='"+G.id+"']");if(F.size()>0){F.remove()}})}});s.click(function(){var E=t.val().replace(/^ | $/g,"");if(E){B.datagrid("load",{searchKey:E})}});t.on("keydown",function(E){if(E.keyCode==13){s.click();E.preventDefault();E.stopPropagation()}});q.click(function(F){var E=g(F.target);if(E.is("span")){if(E.is(".selected")){E.removeClass("selected")}else{E.addClass("selected")}}});v.find("a").click(function(){var J=q.find(".selected");var L=J.size();var I=g(this).index();if(I==5){q.find("span:not(.selected)").addClass("selected")}else{if(L==0){return}}var K=L==q.find("span").size();if(I==0&&!K){var F=J.clone();J.remove();F.insertBefore(q.find("span:first"))}else{if(I==3&&!K){var F=J.clone();J.remove();F.insertAfter(q.find("span:last"))}else{if(I==1&&!K){J.not(":first-child").each(function(){var N=g(this).clone();var M=g(this).prev();if(!M.is(".selected")){N.insertBefore(M);g(this).remove()}})}else{if(I==2&&!K){var G=[];J=J.not(":last-child");for(var H=J.size()-1;H>=0;H--){G.push(J[H])}for(var H=0;H<G.length;H++){var F=g(G[H]).clone();var E=g(G[H]).next();if(!E.is(".selected")){F.insertAfter(E);g(G[H]).remove()}}}else{if(I==4){J.remove();B.datagrid("clearSelections")}else{if(I==6){J.removeClass("selected")}}}}}}});D.find("a[href='#']").attr("href","javascript:void(0)")},success:function(E){var D=[];q.find("span").each(function(){D.push(w[g(this).attr("dataId")])});if(D.length==0){alert("尚未选择任何人员");return false}if(typeof C.success=="function"){E.modal("toggle");C.success(D)}return false}})}function f(w){var y=g.extend({key:"",backdrop:"static",rootId:"O00000001",orgLoad:"",orgTreeQuery:{},orgListQuery:{},singleSelect:false},w);var t={};var v=HAF.basePath()+b;if(!y.orgLoad){y.orgLoad=y.rootId}y.orgTreeQuery.orgId=y.rootId;y.orgListQuery.orgId=y.orgLoad;var u,x,q,s;var r=-1;return a({key:"org_sel_"+y.key,title:"组织机构选择",content:n.selectOrg,backdrop:y.backdrop,width:"700px",ready:function(z){u=z.find("div[haf-comp-id='deptTree'] ul");x=z.find("div[haf-comp-id='orgList'] table");q=z.find("div[haf-comp-id='orgSelected']");s=z.find("div[haf-comp-id='orgSelectedBtns']");u.tree({lines:true,url:v+"?getSelf=true&"+HAF.urlSerialize(y.orgTreeQuery),onBeforeExpand:function(A){y.orgTreeQuery.orgId=A.id;u.tree("options").url=v+"?getSelf=false&"+HAF.urlSerialize(y.orgTreeQuery)},onSelect:function(A){y.orgListQuery.orgId=A.id;z.find(".org-tree-selected").html(A.text);x.datagrid("load",y.orgListQuery)}});x.datagrid({width:330,height:320,fitColumns:true,striped:true,rownumbers:true,border:false,singleSelect:y.singleSelect,url:HAF.basePath()+d+"?t"+(new Date()).getTime(),queryParams:y.orgListQuery,idField:"id",toolbar:z.find(".org-tree-selected"),columns:[[{field:"id",checkbox:true},{field:"unno",title:"组织编号",width:100,align:"center"},{field:"name",title:"组织名称",width:200,align:"left"}]],onSelect:function(C,B){var A=q.find("span[dataId='"+B.id+"']");if(A.size()==0){if(y.singleSelect){q.children().remove();t={}}q.append("<span dataId='"+B.id+"'>"+B.name+"</span>");t[B.id]=B}},onUnselect:function(C,B){var A=q.find("span[dataId='"+B.id+"']");if(A.size()>0){A.remove()}},onSelectAll:function(A){g.each(A,function(D,C){var B=q.find("span[dataId='"+C.id+"']");if(B.size()==0){q.append("<span dataId='"+C.id+"'>"+C.name+"</span>");t[C.id]=C}})},onUnselectAll:function(A){g.each(A,function(D,C){var B=q.find("span[dataId='"+C.id+"']");if(B.size()>0){B.remove()}})}});q.click(function(B){var A=g(B.target);if(A.is("span")){if(A.is(".selected")){A.removeClass("selected")}else{A.addClass("selected")}}});s.find("a").click(function(){var F=q.find(".selected");var H=F.size();var E=g(this).index();if(E==5){q.find("span:not(.selected)").addClass("selected")}else{if(H==0){return}}var G=H==q.find("span").size();if(E==0&&!G){var B=F.clone();F.remove();B.insertBefore(q.find("span:first"))}else{if(E==3&&!G){var B=F.clone();F.remove();B.insertAfter(q.find("span:last"))}else{if(E==1&&!G){F.not(":first-child").each(function(){var J=g(this).clone();var I=g(this).prev();if(!I.is(".selected")){J.insertBefore(I);g(this).remove()}})}else{if(E==2&&!G){var C=[];F=F.not(":last-child");for(var D=F.size()-1;D>=0;D--){C.push(F[D])}for(var D=0;D<C.length;D++){var B=g(C[D]).clone();var A=g(C[D]).next();if(!A.is(".selected")){B.insertAfter(A);g(C[D]).remove()}}}else{if(E==4){F.remove();x.datagrid("clearSelections")}else{if(E==6){F.removeClass("selected")}}}}}}});z.find("a[href='#']").attr("href","javascript:void(0)")},success:function(A){var z=[];q.find("span").each(function(){z.push(t[g(this).attr("dataId")])});if(z.length==0){alert("尚未选择任何组织");return false}if(typeof y.success=="function"){A.modal("toggle");y.success(z)}return false}})}function m(w){var y=g.extend({key:"",backdrop:"static",rootId:"O00000001",orgLoad:"",orgTreeQuery:{},orgListQuery:{},singleSelect:false},w);var t={};var v=HAF.basePath()+b;if(!y.orgLoad){y.orgLoad=y.rootId}y.orgTreeQuery.orgId=y.rootId;y.orgListQuery.orgId=y.orgLoad;var u,x,q,s;var r=-1;return a({key:"org_post_sel_"+y.key,title:"部门职位选择",content:n.selectPost,backdrop:y.backdrop,width:"700px",ready:function(z){u=z.find("div[haf-comp-id='deptTree'] ul");x=z.find("div[haf-comp-id='orgList'] table");q=z.find("div[haf-comp-id='orgSelected']");s=z.find("div[haf-comp-id='orgSelectedBtns']");u.tree({lines:true,url:v+"?getSelf=true&"+HAF.urlSerialize(y.orgTreeQuery),onBeforeExpand:function(A){y.orgTreeQuery.orgId=A.id;u.tree("options").url=v+"?getSelf=false&"+HAF.urlSerialize(y.orgTreeQuery)},onSelect:function(A){y.orgListQuery.orgId=A.id;z.find(".org-tree-selected").html(A.text);x.datagrid("load",y.orgListQuery)}});x.datagrid({width:330,height:320,fitColumns:true,striped:true,rownumbers:true,border:false,singleSelect:y.singleSelect,url:HAF.basePath()+k+"?t"+(new Date()).getTime(),queryParams:y.orgListQuery,toolbar:z.find(".org-tree-selected"),idField:"id",columns:[[{field:"id",checkbox:true},{field:"unno",title:"职位编号",width:100,align:"center"},{field:"name",title:"职位名称",width:200,align:"center"}]],onSelect:function(C,B){var A=q.find("span[dataId='"+B.id+"']");if(A.size()==0){if(y.singleSelect){q.children().remove();t={}}q.append("<span dataId='"+B.id+"'>"+B.name+"</span>");t[B.id]=B}},onUnselect:function(C,B){var A=q.find("span[dataId='"+B.id+"']");if(A.size()>0){A.remove()}},onSelectAll:function(A){g.each(A,function(D,C){var B=q.find("span[dataId='"+C.id+"']");if(B.size()==0){q.append("<span dataId='"+C.id+"'>"+C.name+"</span>");t[C.id]=C}})},onUnselectAll:function(A){g.each(A,function(D,C){var B=q.find("span[dataId='"+C.id+"']");if(B.size()>0){B.remove()}})}});q.click(function(B){var A=g(B.target);if(A.is("span")){if(A.is(".selected")){A.removeClass("selected")}else{A.addClass("selected")}}});s.find("a").click(function(){var F=q.find(".selected");var H=F.size();var E=g(this).index();if(E==5){q.find("span:not(.selected)").addClass("selected")}else{if(H==0){return}}var G=H==q.find("span").size();if(E==0&&!G){var B=F.clone();F.remove();B.insertBefore(q.find("span:first"))}else{if(E==3&&!G){var B=F.clone();F.remove();B.insertAfter(q.find("span:last"))}else{if(E==1&&!G){F.not(":first-child").each(function(){var J=g(this).clone();var I=g(this).prev();if(!I.is(".selected")){J.insertBefore(I);g(this).remove()}})}else{if(E==2&&!G){var C=[];F=F.not(":last-child");for(var D=F.size()-1;D>=0;D--){C.push(F[D])}for(var D=0;D<C.length;D++){var B=g(C[D]).clone();var A=g(C[D]).next();if(!A.is(".selected")){B.insertAfter(A);g(C[D]).remove()}}}else{if(E==4){F.remove();x.datagrid("clearSelections")}else{if(E==6){F.removeClass("selected")}}}}}}});z.find("a[href='#']").attr("href","javascript:void(0)")},success:function(A){var z=[];q.find("span").each(function(){z.push(t[g(this).attr("dataId")])});if(z.length==0){alert("请选择信息");return false}if(typeof y.success=="function"){A.modal("toggle");y.success(z)}return false}})}n={selectPsn:'<table class="person-select"><tr><td><div haf-comp-id="deptTreeBtns"><div class="dropdown"><a href="#" data-toggle="dropdown"><span class="glyphicon glyphicon-list"></span>&nbsp;<span haf-comp-id="deptLabel"></span>&nbsp;<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#">股份公司</a></li><li><a href="#">上级部门</a></li><li><a href="#">我的部门</a></li></ul></div></div><div haf-comp-id="deptTree"><div><ul></ul></div></div></td><td><div class="grid-select-param form-horizontal" style="display:block"><div class="form-group"><label class="col-xs-2 control-label">姓名/拼音</label><div class="col-xs-8"><input class="form-control"></div><div class="col-xs-2" style="text-align:center"><a class="btn btn-default"> <span class="glyphicon glyphicon-search"></span> </a></div></div></div><div haf-comp-id="personList"><table></table></div></td><td><div haf-comp-id="personSelected"></div><div haf-comp-id="personSelectedBtns"><a href="#"><span class="glyphicon glyphicon-open"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-up"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-down"></span></a><a href="#"><span class="glyphicon glyphicon-download-alt"></span></a><a href="#"><span class="glyphicon glyphicon-remove"></span></a><a href="#"><span class="glyphicon glyphicon-saved"></span></a><a href="#"><span class="glyphicon glyphicon-share-alt"></span></a></div></td></tr></table>',selectOrg:'<table class="org-select"><tr><td><div haf-comp-id="deptTree"><div><ul></ul></div></div></td><td><div haf-comp-id="orgList"><div class="org-tree-selected"></div><table></table></div></td><td><div haf-comp-id="orgSelected"></div><div haf-comp-id="orgSelectedBtns"><a href="#"><span class="glyphicon glyphicon-open"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-up"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-down"></span></a><a href="#"><span class="glyphicon glyphicon-download-alt"></span></a><a href="#"><span class="glyphicon glyphicon-remove"></span></a><a href="#"><span class="glyphicon glyphicon-saved"></span></a><a href="#"><span class="glyphicon glyphicon-share-alt"></span></a></div></td></tr></table>',selectPost:'<table class="org-select"><tr><td><div haf-comp-id="deptTree"><div><ul></ul></div></div></td><td><div haf-comp-id="orgList"><div class="org-tree-selected"></div><table></table></div></td><td><div haf-comp-id="orgSelected"></div><div haf-comp-id="orgSelectedBtns"><a href="#"><span class="glyphicon glyphicon-open"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-up"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-down"></span></a><a href="#"><span class="glyphicon glyphicon-download-alt"></span></a><a href="#"><span class="glyphicon glyphicon-remove"></span></a><a href="#"><span class="glyphicon glyphicon-saved"></span></a><a href="#"><span class="glyphicon glyphicon-share-alt"></span></a></div></td></tr></table>',flowConfirm:'<div class="form-horizontal flow-confirm"><div class="form-group"><label class="col-xs-3 control-label">操作类型</label><div class="col-xs-8"><input class="form-control" haf-comp-id="operateName" readonly></div></div><div class="form-group" haf-comp-id="nextNodeRow"><label class="col-xs-3 control-label">下一处理环节<span></span></label><div class="col-xs-8"><input class="form-control"  haf-comp-id="nextNodeName" readonly></div></div><div class="form-group" haf-comp-id="nextPersonRow" style="display:none"><label class="col-xs-3 control-label">下一处理人<span></span></label><div class="col-xs-7"><input class="form-control"  haf-comp-id="nextPersonName" readonly><input class="form-control" type="hidden" haf-comp-id="nextPersonUsername" readonly></div><div class="col-xs-2"><button class="btn btn-info" haf-comp-id="authorSelector">选择…</button></div></div><div haf-comp-id="commentsAddRow" class="form-group" style="display:none"><label class="col-xs-3 control-label">批示意见(500字以内)</label><div haf-comp-id="commentsAdd" class="col-xs-8"><span class="btn btn-link">&nbsp;添加&gt;&gt;</span></div></div><div class="form-group" haf-comp-id="flowCommentRow" style="display:none"><label class="col-xs-3 control-label">批示意见</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="flowComment" rows="3"></textarea></div><div class="col-xs-8 col-xs-offset-3" haf-comp-id="tempComments"><span class="submit">同意</span><span class="submit">批准</span><span class="submit">请处理</span><span class="submit">请执行</span><span class="submit">请批示</span><span class="submit">已执行</span><span class="reject restart">不同意</span><span class="reject restart">返回再议</span><span class="reject restart">请修改后提交</span><span class="reject restart">延后处理</span></div></div><div class="form-group" haf-comp-id="flowMessageRow" style="display:none"><label class="col-xs-3 control-label">消息提醒</label><div class="col-xs-8"><input class="form-control"  haf-comp-id="flowMessage"></div></div></div>',createComm:'<div class="form-horizontal"><input type="hidden" haf-comp-id="refId"><input type="hidden" haf-comp-id="refKey"><div class="form-group"><label class="col-xs-3 control-label">消息主题</label><div class="col-xs-8"><input class="form-control" haf-comp-id="subject"></div></div><div class="form-group"><label class="col-xs-3 control-label">回复人<span></span></label><div class="col-xs-6" ><input class="form-control"  haf-comp-id="replierName" readonly><span style="display:none"><input haf-comp-id="replierId"></span></div><div class="col-xs-2"><button class="btn btn-info" haf-comp-id="replierSelector">选择…</button></div></div><div class="form-group" haf-comp-id="contentRow"><label class="col-xs-3 control-label">沟通内容</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="content" rows="3"></textarea></div></div></div>',replyComm:'<div class="form-horizontal comm-reply"><input type="hidden" haf-comp-id="id"><div class="form-group"><label class="col-xs-3 control-label">发起人</label><div class="col-xs-6"><input class="form-control" haf-comp-id="creatorName" readonly></div><div class="col-xs-2"><span haf-comp-id="ref-form" class="btn btn-link">关联业务表单</span></div></div><div class="form-group"><label class="col-xs-3 control-label">主题</label><div class="col-xs-8"><input class="form-control" haf-comp-id="subject" readonly></div></div><div class="form-group"><label class="col-xs-3 control-label">沟通内容</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="content" rows="3" readonly></textarea></div></div><div class="form-group"><label class="col-xs-3 control-label">回复内容</label><div class="col-xs-8"><textarea class="form-control"  haf-comp-id="replyContent" rows="3"></textarea></div></div></div>',gridSelect:'<table class="grid-select"><tr><td class="grid-select-tree"><div><div><ul></ul></div></div></td><td class="grid-select-grid"><div class="grid-select-param form-horizontal"></div><div class="grid-select-list"><table></table></div></td><td class="grid-selected"><div class="grid-selected-panel"></div><div class="grid-selected-btns"><a href="#"><span class="glyphicon glyphicon-open top"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-up up"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-down down"></span></a><a href="#"><span class="glyphicon glyphicon-download-alt bottom"></span></a><a href="#"><span class="glyphicon glyphicon-remove remove"></span></a><a href="#"><span class="glyphicon glyphicon-saved all"></span></a><a href="#"><span class="glyphicon glyphicon-share-alt refresh"></span></a></div></td></tr></table>',treeSelect:'<table class="tree-select"><tr><td class="grid-select-tree"><div><div><ul></ul></div></div></td><td class="grid-selected"><div class="grid-selected-panel"></div><div class="grid-selected-btns"><a href="#"><span class="glyphicon glyphicon-open top"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-up up"></span></a><a href="#"><span class="glyphicon glyphicon-arrow-down down"></span></a><a href="#"><span class="glyphicon glyphicon-download-alt bottom"></span></a><a href="#"><span class="glyphicon glyphicon-remove remove"></span></a><a href="#"><span class="glyphicon glyphicon-saved all"></span></a><a href="#"><span class="glyphicon glyphicon-share-alt refresh"></span></a></div></td></tr></table>'};var p={modal:function(q){return a(q)},selectPsn:function(q){return o(q)},selectOrg:function(q){return f(q)},selectPost:function(q){return m(q)},HTMLTemplate:n};var c=function(r,q){if(typeof r=="string"){return p[r](q)}else{var q=r||{};return a(q)}};g.extend(h.HAF.Dialog,p);g.extend(h.HAF,{dialog:function(r,q){return c(r,q)}})})(window,undefined,jQuery);(function(i){var q=window.orientation!=undefined;var b=function(s,k){this.id=n++;this.init(s,k)};var o=function(k){if(typeof k==="string"){return new Date(k)}return k};b.prototype={constructor:b,init:function(s,k){var t;if(!(k.pickTime||k.pickDate)){throw new Error("Must choose at least one picker")}this.options=k;this.$element=i(s);this.language=k.language in a?k.language:"cn";this.pickDate=k.pickDate;this.pickTime=k.pickTime;this.isInput=this.$element.is("input");this.component=false;if(this.$element.find(".input-group")||this.$element.find(".datetime-input-group")){this.component=this.$element.find(".input-group-addon")}this.input=this.isInput?this.$element:this.$element.find("input");this.format=k.format;if(!this.format){if(this.isInput){this.format=this.$element.data("format")}else{this.format=this.$element.find("input").data("format")}if(!this.format){if(this.pickDate&&this.pickTime){this.format="yyyy-MM-dd hh:mm:ss"}else{if(this.pickDate){this.format="yyyy-MM-dd"}else{this.format="hh:mm:ss"}}}}this._compileFormat();this.widget=i(d(this.timeIcon,k.pickDate,k.pickTime,k.pick12HourFormat,k.pickSeconds,k.collapse)).appendTo("body");this.minViewMode=k.minViewMode||this.$element.data("date-minviewmode")||0;if(typeof this.minViewMode==="string"){switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}}this.viewMode=k.viewMode||this.$element.data("date-viewmode")||0;if(typeof this.viewMode==="string"){switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0;break}}this.startViewMode=this.viewMode;this.weekStart=k.weekStart||this.$element.data("date-weekstart")||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.setStartDate(k.startDate||this.$element.data("date-startdate"));this.setEndDate(k.endDate||this.$element.data("date-enddate"));this.maxDate=k.maxDate?(typeof(k.maxDate)=="string"?this.parseDate(k.maxDate):k.maxDate):false;this.minDate=k.minDate?(typeof(k.minDate)=="string"?this.parseDate(k.minDate):k.minDate):false;if(!this.pickTime){if(this.maxDate){this.maxDate=new Date(this.maxDate.getFullYear(),this.maxDate.getMonth(),this.maxDate.getDate(),23,59,59,999)}if(this.minDate){this.minDate=new Date(this.minDate.getFullYear(),this.minDate.getMonth(),this.minDate.getDate(),0,0,0,0)}}this.checkValue=typeof k.checkValue=="function"?k.checkValue:false;this.fillDow();this.fillMonths();this.fillHours();this.fillMinutes();this.fillSeconds();this.update();this.showMode();this._attachDatePickerEvents()},show:function(k){this.widget.show();this.height=this.component?this.component.outerHeight():this.$element.outerHeight();this.place();this.$element.trigger({type:"show",date:this._date});this._attachDatePickerGlobalEvents();if(k){k.stopPropagation();k.preventDefault()}},disable:function(){this.$element.find("input").prop("disabled",true);this._detachDatePickerEvents()},enable:function(){this.$element.find("input").prop("disabled",false);this._attachDatePickerEvents()},hide:function(u){var t=this.widget.find(".collapse");for(var k=0;k<t.length;k++){var s=t.eq(k).data("collapse");if(s&&s.transitioning){return}}this.widget.hide();this.viewMode=this.startViewMode;this.showMode();if(u){this.set()}this.$element.trigger({type:"hide",date:this._date});this._detachDatePickerGlobalEvents()},set:function(){if(this.minDate&&this.minDate>this._date){alert("选择日期不能小于"+this.formatDate(this.minDate));return}if(this.maxDate&&this.maxDate<this._date){alert("选择日期不能大于"+this.formatDate(this.maxDate));return}if(this.checkValue&&!this.checkValue(this._date,this.formatDate(this._date))){return}var s="";if(!this._unset){s=this.formatDate(this._date)}if(!this.isInput){if(this.component){var k=this.$element.find("input");k.val(s);this._resetMaskPos(k)}this.$element.data("date",s)}else{this.$element.val(s);this._resetMaskPos(this.$element)}},setValue:function(k){if(!k){this._unset=true}else{this._unset=false}if(typeof k==="string"){this._date=this.parseDate(k)}else{if(k){this._date=new Date(k)}}this.set();this.viewDate=new Date(this._date.getFullYear(),this._date.getMonth(),1,0,0,0,0);this.fillDate();this.fillTime()},getDate:function(){if(this._unset){return null}return new Date(this._date.valueOf())},setDate:function(k){if(!k){this.setValue(null)}else{this.setValue(k.valueOf())}},setStartDate:function(k){if(k instanceof Date){this.startDate=k}else{if(typeof k==="string"){this.startDate=new new Date(k);if(!this.startDate.getFullYear()){this.startDate=-Infinity}}else{this.startDate=-Infinity}}if(this.viewDate){this.update()}},setEndDate:function(k){if(k instanceof Date){this.endDate=k}else{if(typeof k==="string"){this.endDate=new new Date(k);if(!this.endDate.getFullYear()){this.endDate=Infinity}}else{this.endDate=Infinity}}if(this.viewDate){this.update()}},getLocalDate:function(){if(this._unset){return null}var k=this._date;return new Date(k.getFullYear(),k.getMonth(),k.getDate(),k.getHours(),k.getMinutes(),k.getSeconds(),k.getMilliseconds())},setLocalDate:function(k){if(!k){this.setValue(null)}else{this.setValue(k)}},place:function(){var k="absolute";var t=this.component?this.component.parent().offset():this.$element.offset();this.width=this.component?this.component.parent().outerWidth():this.$element.outerWidth();t.top=t.top+this.height;var s=i(window);if(this.options.width!=undefined){this.widget.width(this.options.width)}if(this.options.orientation=="left"){this.widget.addClass("left-oriented");t.left=t.left-this.widget.width()+20}if(this._isInFixed()){k="fixed";t.top-=s.scrollTop();t.left-=s.scrollLeft()}if(s.width()<t.left+this.widget.outerWidth()){t.right=s.width()-t.left-this.width;t.left="auto";this.widget.addClass("pull-right")}else{t.right="auto";this.widget.removeClass("pull-right")}this.widget.css({position:k,top:t.top,left:t.left,right:t.right})},notifyChange:function(){this.$element.trigger({type:"changeDate",date:this.getDate(),localDate:this.getLocalDate()})},update:function(k){var s=k;if(!s){if(this.isInput){s=this.$element.val()}else{s=this.$element.find("input").val()}if(s){this._date=this.parseDate(s)}if(!this._date){var t=new Date;this._date=t}}this.viewDate=new Date(this._date.getFullYear(),this._date.getMonth(),1,0,0,0,0);this.fillDate();this.fillTime()},fillDow:function(){var k=this.weekStart;var s=i("<tr>");while(k<this.weekStart+7){s.append('<th class="dow">'+a[this.language].daysMin[k++%7]+"</th>")}this.widget.find(".datepicker-days thead").append(s)},fillMonths:function(){var s="";var k=0;while(k<12){s+='<span class="month">'+a[this.language].monthsShort[k++]+"</span>"}this.widget.find(".datepicker-months td").append(s)},fillDate:function(){var D=this.viewDate.getFullYear();var B=this.viewDate.getMonth();var s=new Date(this._date.getFullYear(),this._date.getMonth(),this._date.getDate(),0,0,0,0);var C=typeof this.startDate==="object"?this.startDate.getFullYear():-Infinity;var F=typeof this.startDate==="object"?this.startDate.getMonth():-1;var G=typeof this.endDate==="object"?this.endDate.getFullYear():Infinity;var z=typeof this.endDate==="object"?this.endDate.getMonth():12;this.widget.find(".datepicker-days").find(".disabled").removeClass("disabled");this.widget.find(".datepicker-months").find(".disabled").removeClass("disabled");this.widget.find(".datepicker-years").find(".disabled").removeClass("disabled");this.widget.find(".datepicker-days th:eq(1)").text(a[this.language].months[B]+" "+D);var v=new Date(D,B-1,28,0,0,0,0);var E=j.getDaysInMonth(v.getFullYear(),v.getMonth());v.setDate(E);v.setDate(E-(v.getDay()-this.weekStart+7)%7);if(D==C&&B<=F||D<C){this.widget.find(".datepicker-days th:eq(0)").addClass("disabled")}if(D==G&&B>=z||D>G){this.widget.find(".datepicker-days th:eq(2)").addClass("disabled")}var y=new Date(v.valueOf());y.setDate(y.getDate()+42);y=y.valueOf();var x=[];var H;var u;while(v.valueOf()<y){if(v.getDay()===this.weekStart){H=i("<tr>");x.push(H)}u="";if(v.getFullYear()<D||v.getFullYear()==D&&v.getMonth()<B){u+=" old"}else{if(v.getFullYear()>D||v.getFullYear()==D&&v.getMonth()>B){u+=" new"}}if(v.valueOf()===s.valueOf()){u+=" active"}if(v.valueOf()+86400000<=this.startDate){u+=" disabled"}if(v.valueOf()>this.endDate){u+=" disabled"}H.append('<td class="day'+u+'">'+v.getDate()+"</td>");v.setDate(v.getDate()+1)}this.widget.find(".datepicker-days tbody").empty().append(x);var A=this._date.getFullYear();var k=this.widget.find(".datepicker-months").find("th:eq(1)").text(D).end().find("span").removeClass("active");if(A===D){k.eq(this._date.getMonth()).addClass("active")}if(A-1<C){this.widget.find(".datepicker-months th:eq(0)").addClass("disabled")}if(A+1>G){this.widget.find(".datepicker-months th:eq(2)").addClass("disabled")}for(var w=0;w<12;w++){if(D==C&&F>w||D<C){i(k[w]).addClass("disabled")}else{if(D==G&&z<w||D>G){i(k[w]).addClass("disabled")}}}x="";D=parseInt(D/10,10)*10;var t=this.widget.find(".datepicker-years").find("th:eq(1)").text(D+"-"+(D+9)).end().find("td");this.widget.find(".datepicker-years").find("th").removeClass("disabled");if(C>D){this.widget.find(".datepicker-years").find("th:eq(0)").addClass("disabled")}if(G<D+9){this.widget.find(".datepicker-years").find("th:eq(2)").addClass("disabled")}D-=1;for(var w=-1;w<11;w++){x+='<span class="year'+(w===-1||w===10?" old":"")+(A===D?" active":"")+(D<C||D>G?" disabled":"")+'">'+D+"</span>";D+=1}t.html(x)},fillHours:function(){var u=this.widget.find(".timepicker .timepicker-hours table");u.parent().hide();var t="";if(this.options.pick12HourFormat){var v=1;for(var s=0;s<3;s+=1){t+="<tr>";for(var k=0;k<4;k+=1){var w=v.toString();t+='<td class="hour">'+f(w,2,"0")+"</td>";v++}t+="</tr>"}}else{var v=0;for(var s=0;s<5;s+=1){t+="<tr>";for(var k=0;k<4;k+=1){if(v>0&&v<17&&v%4==0){v++}var w=v.toString();t+='<td class="hour">'+f(w,2,"0")+"</td>";v++}t+="</tr>"}}u.html(t)},fillMinutes:function(){var u=this.widget.find(".timepicker .timepicker-minutes table");u.parent().hide();var t="";var v=0;for(var s=0;s<5;s++){t+="<tr>";for(var k=0;k<4;k+=1){var w=v.toString();t+='<td class="minute">'+f(w,2,"0")+"</td>";v+=3}t+="</tr>"}u.html(t)},fillSeconds:function(){var u=this.widget.find(".timepicker .timepicker-seconds table");u.parent().hide();var t="";var v=0;for(var s=0;s<5;s++){t+="<tr>";for(var k=0;k<4;k+=1){var w=v.toString();t+='<td class="second">'+f(w,2,"0")+"</td>";v+=3}t+="</tr>"}u.html(t)},fillTime:function(){if(!this._date){return}var x=this.widget.find(".timepicker span[data-time-component]");var u=x.closest("table");var t=this.options.pick12HourFormat;var k=this._date.getHours();var w="AM";if(t){if(k>=12){w="PM"}if(k===0){k=12}else{if(k!=12){k=k%12}}this.widget.find(".timepicker [data-action=togglePeriod]").text(w)}k=f(k.toString(),2,"0");var v=f(this._date.getMinutes().toString(),2,"0");var s=f(this._date.getSeconds().toString(),2,"0");x.filter("[data-time-component=hours]").text(k);x.filter("[data-time-component=minutes]").text(v);x.filter("[data-time-component=seconds]").text(s)},click:function(y){y.stopPropagation();y.preventDefault();this._unset=false;var x=i(y.target).closest("span, td, th");if(x.length===1){if(!x.is(".disabled")){switch(x[0].nodeName.toLowerCase()){case"th":switch(x[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var s=this.viewDate;var t=j.modes[this.viewMode].navFnc;var v=j.modes[this.viewMode].navStep;if(x[0].className==="prev"){v=v*-1}s["set"+t](s["get"+t]()+v);this.fillDate();break}break;case"span":if(x.is(".month")){var w=x.parent().find("span").index(x);this.viewDate.setMonth(w)}else{var u=parseInt(x.text(),10)||0;this.viewDate.setFullYear(u)}if(this.viewMode!==0){this._date=this.viewDate;this.notifyChange()}this.showMode(-1);this.fillDate();this.set();break;case"td":if(x.is(".day")){var k=parseInt(x.text(),10)||1;var w=this.viewDate.getMonth();var u=this.viewDate.getFullYear();if(x.is(".old")){if(w===0){w=11;u-=1}else{w-=1}}else{if(x.is(".new")){if(w==11){w=0;u+=1}else{w+=1}}}this._date=new Date(u,w,k,this._date.getHours(),this._date.getMinutes(),this._date.getSeconds(),this._date.getMilliseconds());this.viewDate=new Date(u,w,Math.min(28,k),0,0,0,0);this.fillDate();this.set();this.notifyChange()}break}}}},actions:{incrementHours:function(k){this._date.setHours(this._date.getHours()+1)},incrementMinutes:function(k){this._date.setMinutes(this._date.getMinutes()+1)},incrementSeconds:function(k){this._date.setSeconds(this._date.getSeconds()+1)},decrementHours:function(k){this._date.setHours(this._date.getHours()-1)},decrementMinutes:function(k){this._date.setMinutes(this._date.getMinutes()-1)},decrementSeconds:function(k){this._date.setSeconds(this._date.getSeconds()-1)},togglePeriod:function(s){var k=this._date.getHours();if(k>=12){k-=12}else{k+=12}this._date.setHours(k)},showPicker:function(){this.widget.find(".timepicker > div:not(.timepicker-picker)").hide();this.widget.find(".timepicker .timepicker-picker").show()},showHours:function(){this.widget.find(".timepicker .timepicker-picker").hide();this.widget.find(".timepicker .timepicker-hours").show()},showMinutes:function(){this.widget.find(".timepicker .timepicker-picker").hide();this.widget.find(".timepicker .timepicker-minutes").show()},showSeconds:function(){this.widget.find(".timepicker .timepicker-picker").hide();this.widget.find(".timepicker .timepicker-seconds").show()},selectHour:function(t){var u=i(t.target);var k=parseInt(u.text(),10);if(this.options.pick12HourFormat){var s=this._date.getHours();if(s>=12){if(k!=12){k=(k+12)%24}}else{if(k===12){k=0}else{k=k%12}}}this._date.setHours(k);this.actions.showPicker.call(this)},selectMinute:function(s){var t=i(s.target);var k=parseInt(t.text(),10);this._date.setMinutes(k);this.actions.showPicker.call(this)},selectSecond:function(s){var t=i(s.target);var k=parseInt(t.text(),10);this._date.setSeconds(k);this.actions.showPicker.call(this)}},doAction:function(s){s.stopPropagation();s.preventDefault();if(!this._date){this._date=new Date(1970,0,0,0,0,0,0)}var k=i(s.currentTarget).data("action");var t=this.actions[k].apply(this,arguments);this.set();this.fillTime();this.notifyChange();return t},stopEvent:function(k){k.stopPropagation();k.preventDefault()},keydown:function(v){var u=this,t=v.which,s=i(v.target);if(t==8||t==46){setTimeout(function(){u._resetMaskPos(s)})}},keypress:function(v){var u=v.which;if(u==8||u==46){return}var t=i(v.target);var x=String.fromCharCode(u);var w=t.val()||"";w+=x;var s=this._mask[this._maskPos];if(!s){return false}if(s.end!=w.length){return}if(!s.pattern.test(w.slice(s.start))){w=w.slice(0,w.length-1);while((s=this._mask[this._maskPos])&&s.character){w+=s.character;this._maskPos++}w+=x;if(s.end!=w.length){t.val(w);return false}else{if(!s.pattern.test(w.slice(s.start))){t.val(w.slice(0,s.start));return false}else{t.val(w);this._maskPos++;return false}}}else{this._maskPos++}},change:function(s){var k=i(s.target);var t=k.val();if(this._formatPattern.test(t)){this.update();this.setValue(this._date.getTime());this.notifyChange();this.set()}else{if(t&&t.trim()){this.setValue(this._date.getTime());if(this._date){this.set()}else{k.val("")}}else{if(this._date){this.setValue(null);this.notifyChange();this._unset=true}}}this._resetMaskPos(k)},showMode:function(k){if(k){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+k))}this.widget.find(".datepicker > div").hide().filter(".datepicker-"+j.modes[this.viewMode].clsName).show()},destroy:function(){this._detachDatePickerEvents();this._detachDatePickerGlobalEvents();this.widget.remove();this.$element.removeData("datetimepicker");this.component.removeData("datetimepicker")},formatDate:function(k){return this.format.replace(c,function(u){var t,v,w,s=u.length;if(u==="ms"){s=1}v=p[u].property;if(v==="Hours12"){w=k.getHours();if(w===0){w=12}else{if(w!==12){w=w%12}}}else{if(v==="Period12"){if(k.getHours()>=12){return"PM"}else{return"AM"}}else{t="get"+v;w=k[t]()}}if(t==="getMonth"){w=w+1}if(t==="getYear"){w=w+1900-2000}return f(w.toString(),s,"0")})},parseDate:function(x){var t,u,w,s,v,k={};if(!(t=this._formatPattern.exec(x))){return null}for(u=1;u<t.length;u++){w=this._propertiesByIndex[u];if(!w){continue}v=t[u];if(/^\d+$/.test(v)){v=parseInt(v,10)}k[w]=v}return this._finishParsingDate(k)},_resetMaskPos:function(k){var t=k.val();for(var s=0;s<this._mask.length;s++){if(this._mask[s].end>t.length){this._maskPos=s;break}else{if(this._mask[s].end===t.length){this._maskPos=s+1;break}}}},_finishParsingDate:function(s){var w,x,u,k,v,y,t;w=s.FullYear;if(s.Year){w=2000+s.Year}if(!w){w=1970}if(s.Month){x=s.Month-1}else{x=0}u=s.Date||1;k=s.Hours||0;v=s.Minutes||0;y=s.Seconds||0;t=s.Milliseconds||0;if(s.Hours12){k=s.Hours12}if(s.Period12){if(/pm/i.test(s.Period12)){if(k!=12){k=(k+12)%24}}else{k=k%12}}return new Date(w,x,u,k,v,y,t)},_compileFormat:function(){var u,t,w=[],s=[],x=this.format,k={},v=0,y=0;while(u=h.exec(x)){t=u[0];if(t in p){v++;k[v]=p[t].property;w.push("\\s*"+p[t].getPattern(this)+"\\s*");s.push({pattern:new RegExp(p[t].getPattern(this)),property:p[t].property,start:y,end:y+=t.length})}else{w.push(g(t));s.push({pattern:new RegExp(g(t)),character:t,start:y,end:++y})}x=x.slice(t.length)}this._mask=s;this._maskPos=0;this._formatPattern=new RegExp("^\\s*"+w.join("")+"\\s*$");this._propertiesByIndex=k},_attachDatePickerEvents:function(){var k=this;this.widget.on("click",".datepicker *",i.proxy(this.click,this));this.widget.on("click","[data-action]",i.proxy(this.doAction,this));this.widget.on("mousedown",i.proxy(this.stopEvent,this));this.widget.on("click",".picker-time-bot .btn:eq(0)",function(){k.input.val("");k.hide()});this.widget.on("click",".picker-time-bot .btn:eq(1)",function(){k.hide(true)});if(this.isInput){this.$element.on({focus:i.proxy(this.show,this),change:i.proxy(this.change,this)});if(this.options.maskInput){this.$element.on({keydown:i.proxy(this.keydown,this),keypress:i.proxy(this.keypress,this)})}}else{this.$element.on({change:i.proxy(this.change,this)},"input");if(this.options.maskInput){this.$element.on({keydown:i.proxy(this.keydown,this),keypress:i.proxy(this.keypress,this)},"input")}if(this.component){this.component.on("click",i.proxy(this.show,this))}else{this.$element.on("click",i.proxy(this.show,this))}}},_attachDatePickerGlobalEvents:function(){var k=this;i(window).on("resize.datetimepicker"+this.id,i.proxy(this.place,this));if(!this.isInput){i(document).on("mousedown.datetimepicker"+this.id,function(){k.hide(false)})}},_detachDatePickerEvents:function(){this.widget.off("click",".datepicker *",this.click);this.widget.off("click","[data-action]");this.widget.off("mousedown",this.stopEvent);if(this.pickDate&&this.pickTime){this.widget.off("click.togglePicker")}if(this.isInput){this.$element.off({focus:this.show,change:this.change});if(this.options.maskInput){this.$element.off({keydown:this.keydown,keypress:this.keypress})}}else{this.$element.off({change:this.change},"input");if(this.options.maskInput){this.$element.off({keydown:this.keydown,keypress:this.keypress},"input")}if(this.component){this.component.off("click",this.show)}else{this.$element.off("click",this.show)}}},_detachDatePickerGlobalEvents:function(){i(window).off("resize.datetimepicker"+this.id);if(!this.isInput){i(document).off("mousedown.datetimepicker"+this.id)}},_isInFixed:function(){if(this.$element){var s=this.$element.parents();var k=false;for(var t=0;t<s.length;t++){if(i(s[t]).css("position")=="fixed"){k=true;break}}return k}else{return false}}};i.fn.datetimepicker=function(k,s){return this.each(function(){var v=i(this),u=v.data("datetimepicker"),t=typeof k==="object"&&k;if(!u){v.data("datetimepicker",u=new b(this,i.extend({},i.fn.datetimepicker.defaults,t)))}if(typeof k==="string"){u[k](s)}})};i.fn.datetimepicker.defaults={maskInput:false,pickDate:true,pickTime:true,pick12HourFormat:false,pickSeconds:true,startDate:-Infinity,endDate:Infinity,collapse:true};i.fn.datetimepicker.Constructor=b;var n=0;var a=i.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},cn:{days:["周日","周一","周二","周三","周四","周五","周六","周日"],daysShort:["日","一","二","三","四","五","六","日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"]}};var p={dd:{property:"Date",getPattern:function(){return"(0?[1-9]|[1-2][0-9]|3[0-1])\\b"}},MM:{property:"Month",getPattern:function(){return"(0?[1-9]|1[0-2])\\b"}},yy:{property:"Year",getPattern:function(){return"(\\d{2})\\b"}},yyyy:{property:"FullYear",getPattern:function(){return"(\\d{4})\\b"}},hh:{property:"Hours",getPattern:function(){return"(0?[0-9]|1[0-9]|2[0-3])\\b"}},mm:{property:"Minutes",getPattern:function(){return"(0?[0-9]|[1-5][0-9])\\b"}},ss:{property:"Seconds",getPattern:function(){return"(0?[0-9]|[1-5][0-9])\\b"}},ms:{property:"Milliseconds",getPattern:function(){return"([0-9]{1,3})\\b"}},HH:{property:"Hours12",getPattern:function(){return"(0?[1-9]|1[0-2])\\b"}},PP:{property:"Period12",getPattern:function(){return"(AM|PM|am|pm|Am|aM|Pm|pM)\\b"}}};var r=[];for(var e in p){r.push(e)}r[r.length-1]+="\\b";r.push(".");var h=new RegExp(r.join("\\b|"));r.pop();var c=new RegExp(r.join("\\b|"),"g");function g(k){return k.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function f(t,k,u){if(k<t.length){return t}else{return Array(k-t.length+1).join(u||" ")+t}}function d(v,u,k,s,t,w){if(u&&k){return'<div class="bootstrap-datetimepicker-widget dropdown-menu"><table><tr><td class="picker-date"><div class="datepicker">'+j.template+'</div></td><td class="picker-line"><div></div></td><td class="picker-time"><div class="picker-time-tit"><i class="glyphicon glyphicon-time"></i></div><div class="timepicker">'+l.getTemplate(s,t)+'</div><div class="picker-time-bot"><a class="btn btn-default">清除</a>&nbsp;<a class="btn btn-default">确定</a></div></td></tr></table></div>'}else{if(k){return'<div class="bootstrap-datetimepicker-widget dropdown-menu"><table><tr><td class="picker-time only-time"><div class="timepicker">'+l.getTemplate(s,t)+'</div><div class="picker-time-bot"><a class="btn btn-default">清除</a>&nbsp;<a class="btn btn-default">确定</a></div></td></tr></table></div>'}else{return'<div class="bootstrap-datetimepicker-widget dropdown-menu"><table><tr><td class="picker-date"><div class="datepicker">'+j.template+'</div><div class="picker-time-bot"><a class="btn btn-default">清除</a>&nbsp;<a class="btn btn-default">确定</a></div></td></tr></table></div>'}}}function m(){return new Date(Date.UTC.apply(Date,arguments))}var j={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(k){return k%4===0&&k%100!==0||k%400===0},getDaysInMonth:function(k,s){return[31,j.isLeapYear(k)?29:28,31,30,31,30,31,31,30,31,30,31][s]},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};j.template='<div class="datepicker-days"><table class="table-condensed">'+j.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+j.headTemplate+j.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+j.headTemplate+j.contTemplate+"</table></div>";var l={hourTemplate:'<span data-action="showHours" data-time-component="hours" class="timepicker-hour"></span>',minuteTemplate:'<span data-action="showMinutes" data-time-component="minutes" class="timepicker-minute"></span>',secondTemplate:'<span data-action="showSeconds" data-time-component="seconds" class="timepicker-second"></span>'};l.getTemplate=function(k,s){return'<div class="timepicker-picker"><table class="table-condensed"'+(k?' data-hour-format="12"':"")+'><tr><td><a href="#" class="btn btn-default" data-action="incrementHours"><i class="glyphicon glyphicon-chevron-up"></i></a></td><td class="separator"></td><td><a href="#" class="btn btn-default" data-action="incrementMinutes"><i class="glyphicon glyphicon-chevron-up"></i></a></td>'+(s?'<td class="separator"></td><td><a href="#" class="btn btn-default" data-action="incrementSeconds"><i class="glyphicon glyphicon-chevron-up"></i></a></td>':"")+(k?'<td class="separator"></td>':"")+"</tr><tr><td>"+l.hourTemplate+'</td> <td class="separator">:</td><td>'+l.minuteTemplate+"</td> "+(s?'<td class="separator">:</td><td>'+l.secondTemplate+"</td>":"")+(k?'<td class="separator"></td><td><button type="button" class="btn btn-primary" data-action="togglePeriod"></button></td>':"")+'</tr><tr><td><a href="#" class="btn btn-default" data-action="decrementHours"><i class="glyphicon glyphicon-chevron-down"></i></a></td><td class="separator"></td><td><a href="#" class="btn btn-default" data-action="decrementMinutes"><i class="glyphicon glyphicon-chevron-down"></i></a></td>'+(s?'<td class="separator"></td><td><a href="#" class="btn btn-default" data-action="decrementSeconds"><i class="glyphicon glyphicon-chevron-down"></i></a></td>':"")+(k?'<td class="separator"></td>':"")+'</tr></table></div><div class="timepicker-hours" data-action="selectHour"><table class="table-condensed"></table></div><div class="timepicker-minutes" data-action="selectMinute"><table class="table-condensed"></table></div>'+(s?'<div class="timepicker-seconds" data-action="selectSecond"><table class="table-condensed"></table></div>':"")};i.DateTimePicker={isLeapYear:function(k){return j.isLeapYear(k)},getDaysInMonth:function(k,s){return j.getDaysInMonth(k,s)},parseDate:function(k,s){return j.parseDate(k,j.parseFormat(s))},formatDate:function(k,s){return j.formatDate(k,j.parseFormat(s))}}})(window.jQuery);(function(window,undefined,$){if(!window.HAF){return}if(!HAF.Form){HAF.Form={}}function _getBasePath(path){return typeof path=="string"?path:(path?HAF.basePath():"")}var _file_uploader="";function _fileUpload(_options){_options=$.extend({backdrop:"static",allowTypes:[],enableSelect:false,enableUsed:false,singleSelect:true,maxSize:10240},_options);var success=_options.success||function(data){};var error=_options.error||function(msg){alert(msg)};var singleSelect=_options.singleSelect;var returns=_options.returns?_options.returns:["id","originalName","extType","fileSize"];var allowTypes=_options.allowTypes.length?_options.allowTypes:["doc","docx","xls","xlsx","ppt","pptx","rar","zip","pdf","jpg","gif","png","txt"];if(_options.enableUsed){_options.enableSelect=true}var _isAllowType=function(v){for(var i=0;i<allowTypes.length;i++){if(v.toLowerCase()==allowTypes[i]){return true}}return false};if(!_file_uploader){_file_uploader="_"+new Date().getTime()}var upload_url=HAF.basePath()+"/oa/service/attach/upload.do";var download_url=HAF.basePath()+"/oa/service/attach/download.do";var list_url=HAF.basePath()+"/oa/service/attach/list.do?countUsed=true";var class_list_url=HAF.basePath()+"/oa/service/attach/classList.do";var target="_haf_upload_iframe"+_file_uploader;var html='<ul class="nav nav-tabs"><li class="active"><a href="#upload_tab'+_file_uploader+'" data-toggle="tab">文件上传</a></li><li><a href="#att_list_tab'+_file_uploader+'" data-toggle="tab">我的附件库</a></li></ul><div class="tab-content"><div class="tab-pane active haf-uploadify-form" id="upload_tab'+_file_uploader+'"><iframe name="'+target+'" style="display:none;"></iframe><form method="post" enctype="multipart/form-data" class="form-horizontal" style="margin-top:15px" target="'+target+'" action="'+upload_url+'"><div class="form-group"><label class="col-xs-2 control-label">选择文件</label><div class="col-xs-8"><input type="hidden" value="'+_options.maxSize+'" name="maxSize"><input type="file" name="file"></div><div class="col-xs-2 classify-show"><a href="javascript:void(0)" class="btn btn-link">添加分类</a></div></div><div class="form-group classify-panel" style="display:none"><label class="col-xs-2 control-label">文件分类</label><div class="col-xs-10"><input type="text" name="classify" class="form-control"></div></div><div class="form-group"><div class="col-xs-10 col-xs-offset-1"><span class="help-block">附件大小不超过'+_options.maxSize+'KB，格式要求：<span></span></span></div></div></form></div><div class="tab-pane active" id="att_list_tab'+_file_uploader+'"></div></div>';return HAF.dialog({key:_file_uploader,title:"附件上传",content:html,forceInit:true,backdrop:_options.backdrop,width:"700px",ready:function($d){$d.find(".help-block span").html(allowTypes.join("/"));$d.find(".classify-show a").click(function(){$d.find(".classify-panel").show()});$d.find("iframe").unbind().bind("load",function(){var doc=$d.find("iframe")[0].contentDocument||$d.find("iframe")[0].contentWindow.document;var data;var str=doc.body.innerHTML;if(str.replace(/ |\r|\n/,"")){try{data=eval("("+str+")");if(data){if(data.success){success(data.data);$d.modal("toggle")}else{error(data.error)}}}catch(e){error("附件上传失败，附件大小超过系统限制或者网络异常")}}});$d.find(".nav-tabs a:first").click(function(){$d.find("#att_search"+_file_uploader).hide()});$d.find(".nav-tabs a:last").click(function(){var $list=$("#att_list_tab"+_file_uploader);if($list.html()==""){var str='<div style="width:100%;height:230px"><table id="att_list'+_file_uploader+'"></table></div>';$list.append(str);str='<div style="width:320px;position:absolute;right:20px;top:12px;display:none" id="att_search'+_file_uploader+'"><select style="width:200px" class="att-classify"><option value="">全部类型</option><option value="[NULL]">*[未分类]*</option></select><select style="width:100px" class="att-status"><option value="0">未使用</option><option value="1">使用中</option><option value="-1">所有状态</option></select>';$d.find(".modal-body").append(str);$("#att_list"+_file_uploader).datagrid({fit:true,striped:true,method:"POST",rownumbers:true,pageSize:15,pagination:true,pageList:[5,15,30,50],border:false,fitColumns:true,singleSelect:singleSelect,url:list_url,idField:"id",columns:[[{field:"id",checkbox:true,hidden:!_options.enableSelect},{field:"originalName",title:"文件名称",width:200,align:"center"},{field:"createDate",title:"上传时间",width:120,align:"center"},{field:"extType",title:"类型",width:60,align:"center"},{field:"fileSize",title:"大小",width:60,align:"center"},{field:"classify",title:"分类",width:80,align:"center"},{field:"usedCount",title:"使用",width:50,align:"center"},{field:"_action",title:"#",width:60,align:"center",formatter:function(value,row){return"<a target='_blank' href='"+download_url+"?id="+row.id+"' style='color:#3333CC;'>查看</a>"}}]],onSelect:function(rowIndex,rowData){if(!_options.enableSelect||(!_options.enableUsed&&rowData.usedCount>0)){$("#att_list"+_file_uploader).datagrid("unselectRow",rowIndex)}},onSelectAll:function(rows){if(!_options.enableSelect||!_options.enableUsed){$.each(rows,function(i,row){if(row.usedCount>0){$("#att_list"+_file_uploader).datagrid("unselectRow",i)}})}},onLoadSuccess:function(data){if(_options.enableSelect&&!_options.enableUsed){var _checkboxs=$("#att_list"+_file_uploader).datagrid("getPanel").find("table :checkbox");$.each(data.rows,function(i,row){if(row.usedCount>0){_checkboxs.eq(i+1).remove()}})}}});$.get(class_list_url+"?t"+new Date().getTime(),"",function(data){if(data.length){var ss="";$.each(data,function(i,v){ss+='<option value="'+v+'">'+v+"</option>"});$("#att_search"+_file_uploader+" .att-classify").append(ss)}$("#att_search"+_file_uploader+" select").unbind().change(function(){$("#att_list"+_file_uploader).datagrid("load",{classify:$("#att_search"+_file_uploader+" .att-classify").val(),usedStatus:$("#att_search"+_file_uploader+" .att-status").val()})})})}$d.find("#att_search"+_file_uploader).show()})},success:function($d){if($d.find(".nav-tabs li:first").is(".active")){var fileName=$d.find("#upload_tab"+_file_uploader+" input:file").val();if(fileName==""){alert("请选择上传的文件")}else{var arr=fileName.split(".");if(!_isAllowType(arr[arr.length-1])){alert("文件格式不支持（请上传一下格式文件：\n"+allowTypes.join("/")+"）");return false}$d.find("#upload_tab"+_file_uploader+" form")[0].submit()}return false}else{var data=$("#att_list"+_file_uploader).datagrid("getSelections");if(data.length){var r=[];$.each(data,function(i,d){var _d={};$.each(returns,function(j,k){_d[k]=d[k]});r.push(_d)});return success(r)}else{alert("请选择或者上传需要的文件");return false}}}})}function _setUploadify(s,o){var input="";var options={backdrop:"static",editable:false,allowTypes:[],enableSelect:false,enableUsed:false,singleSelect:true,trueDelete:false,refParam:{}};if(o){input=s,$.extend(options,o)}else{if(s){if(typeof s=="object"&&!s.size){$.extend(options,s)}else{input=s}}}if(!input){input=".attach-input"}var $scope=options.$scope||$("body");$(input).each(function(){var $target=$(this);$target.hide();var _options=$(this).data("options");if(_options){if(typeof _options=="string"){_options=eval("({"+_options+"})")}_options=$.extend({},options,_options)}else{_options=$.extend({},options)}var $list;if($target.next().is("div.attach-list")){$list=$target.next();$list.empty()}else{$list=$("<div class='attach-list'></div>");$target.after($list)}if(_options.editable){$list.append("<a class='attach-upload'>添加文件..</a>")}var dd=$(this).val();if(dd){dd=eval("("+dd+")");$list.append(_getListHtml(dd,_options.editable))}if(_options.editable){$list.find(".attach-upload").click(function(){_fileUpload($.extend({},_options,{success:function(data){var _dd=[];if($target.val()){_dd=eval("("+$target.val()+")")}if(_options.singleSelect&&_dd.length>0){if(_dd[0].id!=data[0].id){if(_options.trueDelete){_trueDelete(_dd[0].id,_options.refParam)}$list.find(".attach-list-item").remove();_dd=[]}else{return true}}var ids=_parseIds(_dd);var _ndd=[];$.each(data,function(i,dd){if(!ids[dd.id]){_dd.push(dd);_ndd.push(dd)}});$target.val(HAF.stringify(_dd).replace(/\"/g,"'"));$list.append(_getListHtml(_ndd,_options.editable));return true}}))});$list.delegate(".attach-delete","click",function(){if(_options.trueDelete){_trueDelete($(this).parent().data("id"),_options.refParam,function(){_removeItem($(this).parent(),$target)})}else{_removeItem($(this).parent(),$target)}})}$list.delegate(".attach-item","click",function(){window.open(HAF.basePath()+"/oa/service/attach/download.do?id="+$(this).parent().data("id"))})});function _getListHtml(data,editable){var html="";$.each(data,function(i,att){html+="<div class='attach-list-item' data-id='"+att.id+"'><span class='attach-icon'></span><span class='attach-item'><a href='#'>"+att.originalName+"</a></span>"+(editable?"<span class='attach-delete'></span>":"")+"</div>"});return html}function _trueDelete(id,refParam,callback){var param={attId:id};if(typeof refParam=="object"){$.extend(param,refParam)}else{if(typeof refParam=="function"){$.extend(param,refParam())}}$.post(HAF.basePath()+"/oa/service/ref/delete.do",param,function(data){if(data&&data.success&&callback){callback()}})}function _parseIds(d){var ids={};if(d){$.each(d,function(i,a){ids[a.id]=true})}return ids}function _removeItem($item,$target){var data=eval("("+$target.val()+")");var removeId=$item.data("id");var _dd=[];$.each(data,function(i,dd){if(removeId!=dd.id){_dd.push(dd)}});$target.val(HAF.stringify(_dd).replace(/\"/g,"'"));$item.remove()}}function _setReadonly(form,filters){var $f=$(form||"body"),$e;if(!$f.is("input:text,:radio,:checkbox,select,textarea")){$e=$f.find("input:text,:radio,:checkbox,select,textarea").filter(":enabled")}else{$e=$f}if(filters){$e=$e.filter(filters)}$e.each(function(){if($(this).is(":text,textarea")){this.readOnly=true}else{this.disabled=true}})}function _inputToText(form,filters){var $f=$(form||"body"),$e;if(!$f.is("input:text,textarea")){$e=$f.find("input:text,textarea")}else{$e=$f}if(filters){$e=$e.filter(filters)}$e.each(function(){$(this).hide().after("<p class='form-control-static'>"+$(this).val()+"</p>")})}function _hideButton(form){var $f=$(form||"body");$f.find("input:button,button,.btn,.btn-group").hide()}function _formToJson(form){var data={};var $form=$(form||"body");if($form.size()>0){$form.find("input:text,input:hidden,select,textarea").filter("[name]:enabled").not(".haf-disabled").each(function(){if($(this).val()&&$(this).data("type")=="number"){data[this.name]=parseFloat($(this).val())}else{data[this.name]=$(this).val()}});$form.find("input:checked").each(function(){if($(this).is(":checkbox")){if(!data[this.name]){data[this.name]=[]}data[this.name].push($(this).val())}else{data[this.name]=$(this).val()}})}return data}var _validate={els:{},rules:{mobile:{validator:function(value){var regex=/^(\+\d\d )?(1[3458]{1}[0-9]{1}[\d]{8})$/;return regex.test(value)},message:"输入的手机号码无效"},email:{validator:function(value){return/^([A-Za-z0-9])(\w)+@(\w)+(\.(com|com\.cn|net|cn|net\.cn|org|biz|info|gov|gov\.cn|edu|edu\.cn))$/i.test(value)},message:"输入的电子邮件地址无效"},length:{validator:function(value,param){var len=value.length;if(!param[1]){param[1]=len}return len>=param[0]&&len<=param[1]},message:"输入内容的长度不符合"},number:{validator:function(value,param){var fex="+";if(param){fex="{"+param+"}"}var reg=new RegExp("^[+-]?((\\d+\\.\\d"+fex+")|\\d*)$","g");return reg.test(value)},message:"输入的数值无效"},date:{validator:function(value){var reg=new RegExp("^\\d{4}-((0[1-9])|(1[0-2]))-((0[1-9])|([12][0-9])|(3[01]))$");return reg.test(value)},message:"输入的日期格式有误[yyyy-mm-dd]"},time:{validator:function(value){var reg=new RegExp("^[0-5][0-9]:[0-5][0-9]:[0-5][0-9]$");return reg.test(value)},message:"输入的时间格式有误[hh:mm:ss]"},datetime:{validator:function(value){var reg=new RegExp("^\\d{4}-((0[1-9])|(1[0-2]))-((0[1-9])|([12][0-9])|(3[01])) [0-5][0-9]:[0-5][0-9]:[0-5][0-9]$");return reg.test(value)},message:"输入的时间格式有误[yyyy-mm-dd hh:mm:ss]"}},popover:function($e,msg,label){if($e.is(":hidden")){var $p=$e.parents(".tab-content .tab-pane");if($p.size()>0){$p.each(function(){$(".nav-tabs a[href='#"+$(this).attr("id")+"']").tab("show")})}}if($e.is(":visible")){var $p=$e.parent().is(".input-group")?$e.parent():$e;$p.popover({container:"body",placement:"left",html:true,content:"<div style='color:#aa0000'>"+msg+"</div>",trigger:"manual"}).popover("show").attr("data-popover-destroy",false);$e.focus();$(window).scrollTop($p.offset().top-50);window.setTimeout(function(){$p.popover("destroy").attr("data-popover-destroy",true)},3000);if(!$p.data("popover-event")){$p.attr("data-popover-event",true).on("click",function(){if(!$p.data("popover-destroy")){$p.popover("destroy").attr("data-popover-destroy",true)}})}}else{if(label){msg="["+label+"] "+msg}alert(msg)}},validate:function(fieldId){var validateEls;if(!fieldId){validateEls=_validate.els}else{if(typeof fieldId=="string"){fieldId=fieldId.split(",")}validateEls={};$.each(fieldId,function(i,f){if(_validate.els[f]){validateEls[f]=_validate.els[f]}})}var valid=true;$.each(validateEls,function(k,d){var $e=d.el?$(d.el):$("#"+k);if($e.size()){var val=$e.val();if(d.trim){val=HAF.trim(val)}if(val==""&&d.required){_validate.popover($e,"输入的信息不能为空",d.label);valid=false;return false}if(d.returnMsg){var msg=d.returnMsg(val);if(msg){_validate.popover($e,msg,d.label);valid=false;return false}}if(val!=""&&d.regExp){if(typeof d.regExp=="string"){d.regExp=new RegExp(d.regExp)}if(!d.regExp.test(val)){_validate.popover($e,"输入的数据格式有误",d.label);valid=false;return false}}if(val!=""&&d.length){if(!_validate.rules.length.validator(val,d.length)){_validate.popover($e,_validate.rules.length.message,d.label);valid=false;return false}}if(val!=""&&d.equalTo){var val1=$(d.equalTo).val();if(d.trim){val1=HAF.trim(val1)}if(val!=val1){_validate.popover($e,"输入的信息不一致",d.label);valid=false;return false}}if(val!=""&&d.type&&_validate.rules[d.type]){if(!_validate.rules[d.type].validator(val,d.decimal)){_validate.popover($e,_validate.rules[d.type].message,d.label);valid=false;return false}}}});return valid}};function _setInputSelect(selector){var selector=selector||".select-input";$(selector).hide().each(function(){var $target=$(this);var id=this.id;var $s=false;if(id){$s=$("select[haf-comp-for='"+id+"']")}if(!$s&&$target.next().is("select")){$s=$target.next()}if($s){$s.val($target.val()).change(function(){$target.val($(this).val())}).show()}})}function _setInputGroup(selector,options){if(!selector){return}options=$.extend({editable:false,handle:false},options);var $scope=options.$scope||$("body");$(selector).each(function(){var $target=$(this);var $p=$target.parent();var $g;if($p.is(".normal-input-group")){$g=$p}else{$g=$('<div class="input-group normal-input-group"></div>');$target.after($g);$target.appendTo($g);var $addon=$('<span class="input-group-addon select-group-addon"><span class="glyphicon glyphicon-align-justify"></span></span>');$addon.appendTo($g);if(!options.editable){$(this).attr("readonly","readonly")}if(options.handle){$addon.click(function(){options.handle($target,$scope)})}}})}var __DOWN_LIST_DATA={};function _setDownList(s,o){var selector="",options={multiSelect:false,maxHeight:"200px",editable:false};if(o){selector=s,$.extend(options,o)}else{if(s){if(typeof s=="object"&&!s.size){$.extend(options,s)}else{selector=s}}}if(!selector){selector=".downlist-input"}var $scope=options.$scope||$("body");$(selector).each(function(){var $target=$(this);var $p=$target.parents(".downlist-group");if($p.size()>0){$p=$p.eq(0);$p.find("ul.dropdown-menu").remove()}else{$p=$("<div class='dropdown downlist-group'></div>");$target.after($p);var $g=$('<div class="input-group" data-toggle="dropdown"></div>');$g.appendTo($p);$target.appendTo($g);$g.append('<span class="input-group-addon select-group-addon"><span class="caret"></span></span>')}var _options=$target.data("options");if(_options){if(typeof _options=="string"){if(_options.indexOf("{")==0){_options=eval("("+_options+")")}else{_options=eval("({"+_options+"})")}}_options=$.extend({},options,_options)}else{_options=$.extend({},options)}if(!_options.editable){$target.attr("readonly","readonly")}var $ul=$('<ul class="dropdown-menu" style="min-width:100%;max-height:'+_options.maxHeight+';overflow-y:auto"></ul>');$ul.appendTo($p);if(_options.href||_options.queryParams||_options.type){if(!_options.href||_options.href=="#"){_options.href=HAF.basePath()+"/oa/service/conf/bizType/get.do"}if(!_options.queryParams){_options.queryParams={}}if(_options.type){_options.queryParams.type=_options.type}var surl=_options.href+(_options.href.indexOf("?")>-1?"&":"?")+HAF.urlSerialize(_options.queryParams);if(__DOWN_LIST_DATA[surl]){$ul.append(_getListHtml(__DOWN_LIST_DATA[surl]));_initValues()}else{$.get(surl,{},function(data){__DOWN_LIST_DATA[surl]=data;$ul.append(_getListHtml(data));_initValues()})}}else{if(_options.data){$ul.append(_getListHtml(_options.data));_initValues()}}var checkSelect=_options.checkSelect?_options.checkSelect:function(val,txt){return true};$ul.on("click","li",function(e){var val=$(this).data("value");var txt=$(this).data("text");if(_options.multiSelect){e.stopPropagation();if($(this).is(".selected")){$(this).removeClass("selected")}else{if(!checkSelect(val,txt)){return false}$(this).addClass("selected")}_setFieldValue();if(_options.onSelect){_options.onSelect($(this).data("value"),$(this).data("text"))}}else{if(!$(this).is(".selected")){if(!checkSelect(val,txt)){return false}$(this).parent().find("li.selected").removeClass("selected");$(this).addClass("selected")}_setFieldValue();if(_options.onSelect){_options.onSelect($(this).data("value"),$(this).data("text"))}}});if(_options.editable){$target.on("blur",function(){var values=[];if(_options.multiSelect){values=$(this).val().replace(/^ +| +$/g,"").split(",")}else{values.push($(this).val())}$.each(values,function(i,v){if(v&&$ul.find("li[data-value='"+v+"']").size()==0){if(!_options.multiSelect){$ul.find("li.selected").removeClass("selected")}$ul.append('<li class="selected" data-value="'+v+'" data-text="'+v+'"><a href="javascript:void(0)"><span class="checkmark"></span>'+v+"</a></li>")}})})}function _initValues(){var val="";if(_options.valueField){val=$(_options.valueField,$scope).val()}else{val=$target.val()}if(!val){return}var values=[];if(_options.multiSelect){values=val.replace(/^ +| +$/g,"").split(",")}else{values.push(val)}$.each(values,function(i,v){if(v){var $li=$ul.find("li[data-value='"+v+"']");if($li.size()==0){$ul.append('<li class="selected" data-value="'+v+'" data-text="'+v+'"><a href="javascript:void(0)"><span class="checkmark"></span>'+v+"</a></li>")}else{$li.addClass("selected")}}});_setFieldValue()}function _setFieldValue(){var v=[];var t=[];$ul.parent().find(".selected").each(function(){v.push($(this).data("value"));t.push($(this).data("text"))});if(_options.valueField){$(_options.valueField,$scope).val(v.join(","))}else{$target.val(v.join(","))}if(_options.textField){$(_options.textField,$scope).val(t.join(","))}}});function _getListHtml(data){var html="";if(typeof data=="string"){data=data.split(",")}$.each(data,function(i,dd){if(typeof dd=="string"){dd=dd.split(",")}if(dd.length<2){dd.push(dd[0])}html+='<li data-value="'+dd[0]+'" data-text="'+dd[1]+'"'+(HAF.isEmpty(dd[2])?"":' title="'+dd[2]+'"')+'><a href="javascript:void(0)"><span class="checkmark"></span>'+dd[1]+"</a></li>"});return html}}function _setDatepicker(s,o){if(!s){s=".date-input"}if(!o){o={}}_setDatetimepicker(s,$.extend({pickTime:false},o))}function _setDatetimepicker(s,o){var selector="",options={editable:false,pickDate:true,pickTime:true};if(o){selector=s,$.extend(options,o)}else{if(s){if(typeof s=="object"&&!s.size){$.extend(options,s)}else{selector=s}}}if(!selector){selector=".datetime-input"}$(selector).each(function(){var _options=$(this).data("options");if(_options){if(typeof _options=="string"){_options=eval("({"+_options+"})")}_options=$.extend({},options,_options)}else{_options=$.extend({},options)}if(!_options.editable){$(this).attr("readonly","readonly")}$(this).off();var $p=$(this).parent();var $g;if($p.is(".datetime-input-group")){$g=$p}else{$g=$('<div class="input-group datetime-input-group"></div>');$(this).after($g);$(this).appendTo($g);if(_options.pickDate){$g.append('<span class="input-group-addon select-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>')}else{$g.append('<span class="input-group-addon select-group-addon"><span class="glyphicon glyphicon-time"></span></span>')}}$g.datetimepicker(_options)})}function _setPersonSelect(s,o){var selector="",options={};if(o){selector=s,$.extend(options,o)}else{if(s){if(typeof s=="object"&&!s.size){$.extend(options,s)}else{selector=s}}}if(!selector){selector=".person-input"}options=$.extend({defaultMyDept:true,singleSelect:true},options);var $scope=options.$scope||$("body");$(selector).each(function(){$(this).attr("readonly","readonly");var $p=$(this).parent();var $g=$('<div class="input-group"></div>');$p.append($g).addClass("person-input-group");$(this).appendTo($g);var $btn=$('<span class="input-group-addon select-group-addon"><span class="glyphicon glyphicon-align-justify"></span></span>');$btn.appendTo($g);var _options=$(this).data("options");if(_options){if(typeof _options=="string"){_options=eval("({"+_options+"})")}_options=$.extend({},options,_options)}else{_options=$.extend({},options)}if(_options.returns){var _success=_options.success;_options.success=function(persons){$.each(_options.returns,function(k,v){$(v,$scope).val(HAF.getListValue(persons,k,","))});if(typeof _success=="function"){return _success(persons)}}}$btn.click(function(){HAF.Dialog.selectPsn(_options)})})}function _setComorgSelect(s,o){var selector="",options={};if(o){selector=s,$.extend(options,o)}else{if(s){if(typeof s=="object"&&!s.size){$.extend(options,s)}else{selector=s}}}if(!selector){selector=".comorg-input"}options=$.extend({singleSelect:true},options);var $scope=options.$scope||$("body");$(selector).each(function(){$(this).attr("readonly","readonly");var $p=$(this).parent();var $g=$('<div class="input-group"></div>');$p.append($g).addClass("comorg-input-group");$(this).appendTo($g);var $btn=$('<span class="input-group-addon select-group-addon"><span class="glyphicon glyphicon-align-justify"></span></span>');$btn.appendTo($g);var _options=$(this).data("options");if(_options){if(typeof _options=="string"){_options=eval("({"+_options+"})")}_options=$.extend({},options,_options)}else{_options=$.extend({},options)}if(_options.returns){var _success=_options.success;_options.success=function(orgs){$.each(_options.returns,function(k,v){$(v,$scope).val(HAF.getListValue(orgs,k,","))});if(typeof _success=="function"){return _success(orgs)}}}$btn.click(function(){HAF.Dialog.selectOrg(_options)})})}function _setPositionSelect(s,o){var selector="",options={};if(o){selector=s,$.extend(options,o)}else{if(s){if(typeof s=="object"&&!s.size){$.extend(options,s)}else{selector=s}}}if(!selector){selector=".position-input"}options=$.extend({singleSelect:true},options);var $scope=options.$scope||$("body");$(selector).each(function(){$(this).attr("readonly","readonly");var $p=$(this).parent();var $g=$('<div class="input-group"></div>');$p.append($g).addClass("position-input-group");$(this).appendTo($g);var $btn=$('<span class="input-group-addon select-group-addon"><span class="glyphicon glyphicon-align-justify"></span></span>');$btn.appendTo($g);var _options=$(this).data("options");if(_options){if(typeof _options=="string"){_options=eval("({"+_options+"})")}_options=$.extend({},options,_options)}else{_options=$.extend({},options)}if(_options.returns){var _success=_options.success;_options.success=function(posts){$.each(_options.returns,function(k,v){$(v,$scope).val(HAF.getListValue(posts,k,","))});if(typeof _success=="function"){return _success(posts)}}}$btn.click(function(){HAF.Dialog.selectPost(_options)})})}function _gridEditDialog(options){var _data=options.rowData||{};var $elements={};var checkValues={};var $form=$('<form class="form-horizontal"></form>');if(options.hidden&&options.hidden.length){$.each(options.hidden,function(i,name){var val=typeof _data[name]=="undefined"?"":_data[name];$elements[name]=$('<input type="hidden" name="'+name+'" value="'+val+'">');$form.append($elements[name])})}$.each(options.visible,function(i,group){var $group=$('<div class="form-group"></div>');$.each(group,function(ii,field){$group.append('<label class="col-xs-'+(field.labelWidth||"2")+' control-label">'+field.label+"</label>");var $field;if(field.type=="textarea"){$field=$('<textarea name="'+field.name+'" class="form-control"></textarea>')}else{if(field.type=="select"){$field=$('<select name="'+field.name+'" class="form-control"><option value=""></option></select>');$.each(field.options,function(iii,vv){$field.append('<option value="'+vv[0]+'">'+(vv[1]||vv[0])+"</option>")})}else{if(field.type=="radio"||field.type=="checkbox"){var str="";$.each(field.options,function(iii,vv){str+='<input value="'+vv[0]+'" name="'+field.name+'" type="'+field.type+'">'+(vv[1]||vv[0])+"&nbsp;"});$field=$(str)}else{if(field.type=="html"){$field=$(field.html)}else{$field=$('<input value="" name="'+field.name+'" type="text" class="form-control">')}}}}if(field.readonly||options.readonly){$field.attr("readonly","readonly")}if(field.hidden){$field.hide()}if(field.disabled){$field.addClass("haf-disabled")}var $div=$('<div class="col-xs-'+(field.fieldWidth||"4")+'"></div>');$field.appendTo($div);$div.appendTo($group);$group.appendTo($form);$elements[field.name]=$field;if(field.checkValue){checkValues[field.name]=field.checkValue}if(typeof _data[field.name]!="undefined"&&_data[field.name]!=null){$field.val(_data[field.name]+"")}if(!options.readonly){if(field.type=="date"){_setDatepicker($field,field.options)}else{if(field.type=="person"){_setPersonSelect($field,$.extend({key:"gridEditorP",backdrop:false,$scope:$form},field.options))}else{if(field.type=="comorg"){_setComorgSelect($field,$.extend({key:"gridEditorO",backdrop:false,$scope:$form},field.options))}else{if(field.type=="downlist"){_setDownList($field,$.extend({$scope:$form},field.options))}else{if(field.type=="attach"){_setUploadify($field,$.extend({backdrop:false,$scope:$form},field.options))}else{if(field.type=="inputgroup"){_setInputGroup($field,$.extend({$scope:$form},field.options))}}}}}}}else{if(field.type=="attach"){_setUploadify($field,$.extend({backdrop:false,$scope:$form},field.options,{editable:false}))}}})});var _ready=typeof options.onload=="function"?options.onload:false;var _success=typeof options.callback=="function"?options.callback:false;var _confirm=typeof options.onConfirm=="function"?options.onConfirm:false;HAF.dialog({key:"grid_edit",title:options.title||"新增/编辑",content:$form,width:options.width||"650px",ready:function($d){if(_ready){_ready($d)}},success:function($d){if(options.readonly){return true}var valid=true;if(_confirm){var _b=_confirm($d,options);if(typeof _b=="boolean"&&!_b){return false}}if(options.validate&&options.validate.length){$d.find("[name='"+options.validate.join("'],[name='")+"']").each(function(){if($(this).val()==""){valid=false;var msg=HAF.getValue(options,"validateMsg."+this.name,false);if(!msg){var $p=$(this);for(var i=0;i<4;i++){if($p.prev().is("label")){msg=$p.prev().text();break}$p=$p.parent()}}if(msg){alert("请填写："+msg)}else{alert("有未填写的必填项目，请检查")}if($(this).is(":visible")){$(this).focus()}return false}})}if(!valid){return false}$.each(checkValues,function(name,func){valid=func($elements[name].val());if(typeof valid=="boolean"&&!valid){return false}else{valid=true}});if(!valid){return false}if(_success){var dd=$.extend(_data,_formToJson($d));var r=_success(dd);if(typeof r=="boolean"&&r==false){return false}}return true}})}function _gridAttachLoad(table){$(table).datagrid("getPanel").delegate("a.attach-detail","mousedown",function(){var offset=$(this).offset();var width=$(this).width();var height=$(this).height();var $p=$(this).data("attach-detail-panel");if($p){if($p.is(":visible")){$p.hide()}else{$p.css({top:offset.top+height,left:offset.left,width:width}).show()}return false}$p=$("<div class='attach-detail-panel'></div>");$p.css({position:"absolute",top:offset.top+height,left:offset.left,width:width});$(this).next().show().appendTo($p);$p.appendTo("body");$(this).data("attach-detail-panel",$p)})}function _gridAttachFormat(data){if(!data){return""}var dd=eval("("+data+")");var ss='<a href="javascript:void(0)" class="attach-detail">查看 <span class="caret"></span></a><ul class="dropdown-menu pull-right" style="display:none">';$.each(dd,function(i,att){ss+='<li><a href="'+HAF.basePath()+"/oa/service/attach/download.do?id="+att.id+'" target="_blank">'+att.originalName+"</a></li>"});ss+="</ul>";return ss}function _init(options){options=$.extend({submitUrl:"",ready:function(){},onSubmit:function(){return true},parseData:function(){return false},afterSubmit:function(){},defButtons:["quit","submit"],buttons:[]},options);var defButtons={quit:{label:"退出",clsName:"btn-info",handle:function(){HAF.closeWindow()}},submit:{label:"提交",clsName:"btn-primary",handle:function(){if(!options.submitUrl||!options.parseData()){alert("表单提交失败，初始化参数配置有误");return}else{if(!options.onSubmit()){return}HAF.ajax({url:HAF.basePath()+options.submitUrl,contentType:"application/json",data:HAF.stringify(options.parseData()),success:function(data){if(data&&data.success){alert("表单提交成功！");options.afterSubmit();HAF.closeWindow()}else{alert("操作失败！错误原因："+data.error)}}})}}}};$(".haf-form-header").append('<div class="btn-toolbar form-buttons"><div class="btn-group"></div></div>');var $bar=$(".haf-form-header .form-buttons .btn-group");if(options.defButtons){$.each(options.defButtons,function(i,k){if(defButtons[k]){var $btn=$('<button class="btn">'+defButtons[k].label+"</button>");var $grp=$('<div class="btn-group flom-btn-'+k+'"></div>');$grp.append($btn).appendTo($bar);if(defButtons[k].clsName){$btn.addClass(defButtons[k].clsName)}else{$btn.addClass("btn-info")}$btn.click(function(){defButtons[k].handle()})}})}if(options.buttons){$.each(options.buttons,function(i,o){if(o){var $btn=$('<button class="btn">'+o.label+"</button>");var $grp=$('<div class="btn-group flom-btn-'+o.type+'"></div>');$grp.append($btn).appendTo($bar);if(o.clsName){$btn.addClass(o.clsName)}else{$btn.addClass("btn-info")}if(o.handle){$btn.click(function(){o.handle()})}}})}}function _searchGrid(form,options){var options=$.extend({basePath:false,url:"",width:"700px",height:"350px",border:false,fitColumns:true,defaultParams:{},searchParams:[],columns:[],pagination:true,pageSize:15,pageList:[10,15,20,30,50,100],dataType:"json",singleSelect:false,toolbar:null,idField:"id"},options);options.basePath=_getBasePath(options.basePath);var gridUrl=options.url?(options.basePath+options.url):"";if(!gridUrl){return}var $form=$(form);$form.addClass("search-grid-form");var $params,$grid;var gHeight=parseInt(options.height);var defaultParams=$.extend({},options.defaultParams);if(options.searchParams&&options.searchParams.length){$params=$('<div class="form-horizontal search-grid-params"></div>');$params.width(options.width).appendTo($form);var $hidden=$("<div style='display:none'></div>");$hidden.appendTo($params);var $group,colspan,j=0;$.each(options.searchParams,function(i,o){if(o.hidden||o.type=="hidden"){$hidden.append('<input type="hidden" name="'+o.name+'" value="'+(o.defaultValue||"")+'">');return true}if(o.display&&o.display=="row"){colspan=8;j++}else{colspan=3}if(j%2==0||colspan==8){$group=$('<div class="form-group"></div>');$group.appendTo($params)}$group.append('<label class="col-xs-2 control-label">'+o.label+"</label>");var $field=$('<input value="'+(o.defaultValue||"")+'" name="'+o.name+'" class="form-control">');var $div=$('<div class="col-xs-'+colspan+'"></div>');$div.append($field);$group.append($div);if(o.type=="date"){_setDatepicker($field,{editable:true})}else{if(o.type=="downlist"){$.extend({editable:true,$scope:$params},o.options);_setDownList($field,o.options)}else{if(o.type=="person"){_setPersonSelect($field,$.extend({key:"sGridP",backdrop:false,$scope:$params},o.options))}else{if(o.type=="comorg"){_setComorgSelect($field,$.extend({key:"sGridO",backdrop:false,$scope:$params},o.options))}else{if(o.type=="inputgroup"){_setInputGroup($field,$.extend({$scope:$params},o.options))}}}}}j++});$group.append('<div class="col-xs-2" style="text-align:center"><a class="btn btn-default"> <span class="glyphicon glyphicon-search"></span> </a></div>');gHeight=gHeight-$params.outerHeight();$params.find("a.btn").click(function(){$grid.datagrid("clearSelections").datagrid("load",$.extend(options.defaultParams,_formToJson($params)))});$params.on("keydown","input",function(e){if(e.keyCode==13){$params.find("a.btn").click();e.preventDefault();e.stopPropagation()}});$.extend(defaultParams,_formToJson($params))}var $panel=$('<div class="form-horizontal search-grid-panel"></div>');$panel.appendTo($form);$panel.append('<div class="form-group"><div class="col-xs-12"><table></table></div></div>');$panel.find("> div > div").css({height:gHeight,width:options.width});$grid=$panel.find("table");var gridOptions={fit:true,striped:true,method:"POST",rownumbers:true,pageSize:options.pageSize,pagination:options.pagination,pageList:options.pageList,border:options.border,fitColumns:options.fitColumns,singleSelect:options.singleSelect,url:gridUrl,queryParams:defaultParams,idField:options.idField,columns:[options.columns],frozenColumns:options.frozenColumns?[options.frozenColumns]:undefined,onDblClickRow:function(rowIndex,rowData){if(rowData.url){window.open(rowData.url)}},toolbar:options.toolbar};if(options.onLoadSuccess){$.extend(gridOptions,{onLoadSuccess:function(data){options.onLoadSuccess(data)}})}if(options.onDblClickRow){$.extend(gridOptions,{onDblClickRow:function(rowIndex,rowData){options.onDblClickRow(rowIndex,rowData)}})}if(options.onSelect){$.extend(gridOptions,{onSelect:function(rowIndex,rowData){options.onSelect(rowIndex,rowData)}})}if(options.onClickRow){$.extend(gridOptions,{onClickRow:function(rowIndex,rowData){options.onClickRow(rowIndex,rowData)}})}if(options.onClickCell){$.extend(gridOptions,{onClickCell:function(rowIndex,field,value){options.onClickCell(rowIndex,field,value)}})}if(options.onDblClickCell){$.extend(gridOptions,{onDblClickCell:function(rowIndex,field,value){options.onDblClickCell(rowIndex,field,value)}})}$grid.datagrid(gridOptions);if(options.width=="100%"){$(window).resize(function(){$panel.width($params.width());$grid.datagrid("resize")})}return $grid}function _gridSelect(options){var options=$.extend({key:"",title:"选择",width:"700px",height:"350px",backdrop:"static",basePath:true,searchParams:[],treeUrl:"",treeIdField:"id",treeParams:{},gridUrl:"",defaultParams:{},gridTreeIdField:"id",selectedFieldShow:"id",pagination:false,columns:[],dataType:"json",singleSelect:false,defaultValues:[]},options);options.basePath=_getBasePath(options.basePath);var selectedData={};var treeUrl=options.treeUrl?(options.basePath+options.treeUrl):"";var gridUrl=options.gridUrl?(options.basePath+options.gridUrl):"";if(!gridUrl){return alert("对话框参数配置有误，缺少gridUrl")}var $tree,$params,$grid,$selected,$selectedBtns;var treeBtnIndex=-1;return HAF.dialog({key:"grid_sel_"+options.key,title:options.title,content:HAF.Dialog.HTMLTemplate.gridSelect,backdrop:options.backdrop,width:options.width,forceInit:true,ready:function($dialog){var gHeight=parseInt(options.height);$selected=$dialog.find(".grid-selected-panel");$selectedBtns=$dialog.find(".grid-selected-btns");$selected.height(gHeight-$selectedBtns.outerHeight());if(treeUrl){$dialog.find(".grid-select-tree").show();$dialog.find(".grid-select-tree > div").height(options.height);$tree=$dialog.find(".grid-select-tree ul");$tree.tree({lines:true,url:treeUrl,onBeforeExpand:function(node){options.treeParams[options.treeIdField]=node.id;$tree.tree("options").url=treeUrl+"?"+HAF.urlSerialize(options.treeParams)},onSelect:function(node){options.defaultParams[options.gridTreeIdField]=node.id;$params.find(".btn").click()}})}if(options.searchParams&&options.searchParams.length){$params=$dialog.find(".grid-select-param");$params.show();var $hidden=$("<div style='display:none'></div>");var $group,colspan,j=0;$.each(options.searchParams,function(i,o){if(o.hidden||o.type=="hidden"){$hidden.append('<input type="hidden" name="'+o.name+'">');return true}if(o.display&&o.display=="row"){colspan=8;j++}else{colspan=3}if(j%2==0||colspan==8){$group=$('<div class="form-group"></div>');$group.appendTo($params)}$group.append('<label class="col-xs-2 control-label">'+o.label+"</label>");var $field=$('<input value="" name="'+o.name+'" type="text" class="form-control">');var $div=$('<div class="col-xs-'+colspan+'"></div>');$div.append($field);$group.append($div);if(window.HAF.Form){if(o.type=="date"){_setDatetimepicker($field,{editable:true})}else{if(o.type=="downlist"){$.extend({editable:true,$scope:$params},o.options);_setDownList($field,o.options)}else{if(o.type=="person"){_setPersonSelect($field,$.extend({key:"seGridP",backdrop:false,$scope:$params},o.options))}else{if(o.type=="comorg"){_setComorgSelect($field,$.extend({key:"seGridO",backdrop:false,$scope:$params},o.options))}else{if(o.type=="inputgroup"){_setInputGroup($field,$.extend({$scope:$params},o.options))}}}}}}j++});$group.append('<div class="col-xs-2" style="text-align:center"><a class="btn btn-default"> <span class="glyphicon glyphicon-search"></span> </a></div>');$hidden.appendTo($params);gHeight=gHeight-$params.outerHeight();$group.find("a.btn").click(function(){$grid.datagrid("load",$.extend({},options.defaultParams,_formToJson($params)))});$group.on("keydown","input",function(e){if(e.keyCode==13){$group.find("a.btn").click();e.preventDefault();e.stopPropagation()}})}var idField=options.idField||"id";$dialog.find(".grid-select-list").css({height:gHeight,width:$dialog.find(".grid-select-grid").width()});$grid=$dialog.find(".grid-select-list table");$grid.datagrid({fit:true,striped:true,method:"POST",rownumbers:true,pageSize:15,pagination:options.pagination,pageList:[5,15,30,50],border:false,fitColumns:true,singleSelect:options.singleSelect,url:gridUrl,queryParams:options.defaultParams,idField:idField,columns:[options.columns],onSelect:function(rowIndex,rowData){var span=$selected.find("span[dataId='"+rowData[idField]+"']");if(span.size()==0){if(options.singleSelect){$selected.children().remove();selectedData={}}$selected.append("<span dataId='"+rowData[idField]+"'>"+rowData[options.selectedFieldShow]+"</span>");selectedData[rowData[idField]]=rowData}},onUnselect:function(rowIndex,rowData){var span=$selected.find("span[dataId='"+rowData[idField]+"']");if(span.size()>0){span.remove()}},onSelectAll:function(rows){$.each(rows,function(rowIndex,rowData){var span=$selected.find("span[dataId='"+rowData[idField]+"']");if(span.size()==0){$selected.append("<span dataId='"+rowData[idField]+"'>"+rowData[options.selectedFieldShow]+"</span>");selectedData[rowData[idField]]=rowData}})},onUnselectAll:function(rows){$.each(rows,function(rowIndex,rowData){var span=$selected.find("span[dataId='"+rowData[idField]+"']");if(span.size()>0){span.remove()}})}});$.each(options.defaultValues,function(i,v){var span=$selected.find("span[dataId='"+v[idField]+"']");if(span.size()==0){if(options.singleSelect){$selected.children().remove();selectedData={}}$selected.append("<span dataId='"+v[idField]+"'>"+v[options.selectedFieldShow]+"</span>");selectedData[v[idField]]=v}});$selected.click(function(e){var _t=$(e.target);if(_t.is("span")){if(_t.is(".selected")){_t.removeClass("selected")}else{_t.addClass("selected")}}});$selectedBtns.find("a").click(function(){var selecteds=$selected.find(".selected");var sSize=selecteds.size();var btnIndex=$(this).index();if(btnIndex==5){$selected.find("span:not(.selected)").addClass("selected")}else{if(sSize==0){return}}var selectAll=sSize==$selected.find("span").size();if(btnIndex==0&&!selectAll){var _c=selecteds.clone();selecteds.remove();_c.insertBefore($selected.find("span:first"))}else{if(btnIndex==3&&!selectAll){var _c=selecteds.clone();selecteds.remove();_c.insertAfter($selected.find("span:last"))}else{if(btnIndex==1&&!selectAll){selecteds.not(":first-child").each(function(){var _c=$(this).clone();var _p=$(this).prev();if(!_p.is(".selected")){_c.insertBefore(_p);$(this).remove()}})}else{if(btnIndex==2&&!selectAll){var reverse=[];selecteds=selecteds.not(":last-child");for(var i=selecteds.size()-1;i>=0;i--){reverse.push(selecteds[i])}for(var i=0;i<reverse.length;i++){var _c=$(reverse[i]).clone();var _n=$(reverse[i]).next();if(!_n.is(".selected")){_c.insertAfter(_n);$(reverse[i]).remove()}}}else{if(btnIndex==4){selecteds.remove();$grid.datagrid("clearSelections")}else{if(btnIndex==6){selecteds.removeClass("selected")}}}}}}});$dialog.find("a[href='#']").attr("href","javascript:void(0)")},success:function($dialog){var _data=[];$selected.find("span").each(function(){_data.push(selectedData[$(this).attr("dataId")])});if(_data.length==0){alert("尚未选择任何记录");return false}if(typeof options.success=="function"){$dialog.modal("toggle");options.success(_data)}return false}})}var _ex_file_uploader;function _dataImportDialog(options){var options=$.extend({backdrop:"static",templateUrl:"",submitUrl:"",basePath:true,success:function(data){alert("导入操作完成")},error:function(msg){alert(msg)}},options);var allowTypes=["xls","xlsx"];var _isAllowType=function(v){for(var i=0;i<allowTypes.length;i++){if(v.toLowerCase()==allowTypes[i]){return true}}return false};if(!_ex_file_uploader){_ex_file_uploader="_"+new Date().getTime()}var basePath=_getBasePath(options.basePath);var upload_url=basePath+options.submitUrl;var download_url=basePath+options.templateUrl;var target="_haf_ex_upload_iframe"+_ex_file_uploader;var html='<div><iframe name="'+target+'" style="display:none;"></iframe><form method="post" enctype="multipart/form-data" class="form-horizontal" style="margin-top:15px" target="'+target+'" action="'+upload_url+'"><div class="form-group"><label class="col-xs-3 control-label">选择Excel文件</label><div class="col-xs-9"><input type="file" name="file" style="width:50%;float:left"></div></div><div class="form-group"><label class="col-xs-3 control-label">模板下载</label><div class="col-xs-9"><a class="btn btn-link" href="'+download_url+'" target="_blank">点击下载Excel模板</a><span class="help-block">1、请严格按照Excel模板整理数据</span><span class="help-block">2、导入文件仅支持xls、xlsx格式</span></div></div></form></div>';return HAF.dialog({key:_ex_file_uploader,title:"Excel导入",content:html,forceInit:true,backdrop:options.backdrop,width:"600px",ready:function($d){$d.find("iframe").unbind().bind("load",function(){var doc=$d.find("iframe")[0].contentDocument||$d.find("iframe")[0].contentWindow.document;var data;var str=doc.body.innerHTML;if(str.replace(/ |\r|\n/,"")){try{data=eval("("+str+")");if(data){if(data.success){if(options.success){options.success(data.data)}$d.modal("toggle")}else{options.error(data.error)}}}catch(e){options.error("系统错误，操作失败")}}})},success:function($d){var fileName=$d.find("form input:file").val();if(fileName==""){alert("请选择Excel导入文件")}else{var arr=fileName.split(".");if(!_isAllowType(arr[arr.length-1])){alert("文件格式不支持，请选择Excel文件");return false}$d.find("form")[0].submit()}return false}})}function _destroyInputGroup(selector){if(!selector){selector=".downlist-input-group input,comorg-input-group input,person-input-group input,datetime-input-group input,normal-input-group input"}$(selector).each(function(){var $target=$(this);var $p=$target.parent();if($p.is(".input-group")){if($p.parent().is(".downlist-group")){$p=$p.parent()}$p.after($target);$p.remove()}})}$.extend(window.HAF.Form,{init:function(options){_init(options);return window.HAF.Form},fileUpload:function(options){_fileUpload(options);return window.HAF.Form},uploadify:function(s,o){_setUploadify(s,o);return window.HAF.Form},readonly:function(form,filters){_setReadonly(form,filters);return window.HAF.Form},inputToText:function(form,filters){_inputToText(form,filters);return window.HAF.Form},hideButton:function(form){_hideButton(form);return window.HAF.Form},inputSelect:function(s){_setInputSelect(s);return window.HAF.Form},inputGroup:function(s,o){_setInputGroup(s,o);return window.HAF.Form},downList:function(s,o){_setDownList(s,o);return window.HAF.Form},datepicker:function(s,o){_setDatepicker(s,o);return window.HAF.Form},datetimepicker:function(s,o){_setDatetimepicker(s,o);return window.HAF.Form},personSelect:function(s,o){_setPersonSelect(s,o);return window.HAF.Form},comorgSelect:function(s,o){_setComorgSelect(s,o);return window.HAF.Form},positionSelect:function(s,o){_setPositionSelect(s,o);return window.HAF.Form},gridEditor:function(options){_gridEditDialog(options);return window.HAF.Form},gridAttachLoad:function(table){_gridAttachLoad(table);return window.HAF.Form},gridAttachFormat:function(data){return _gridAttachFormat(data)},formToJson:function(form){return _formToJson(form)},validate:function(eIds){return _validate.validate(eIds)},setValidate:function(opt){if(opt.els){$.extend(_validate.els,opt.els)}if(opt.rules){$.extend(_validate.rules,opt.rules)}return window.HAF.Form},searchGrid:function(form,options){return _searchGrid(form,options)},gridSelect:function(options){_gridSelect(options);return window.HAF.Form},dataImportDialog:function(o){return _dataImportDialog(o)},destroyInputGroup:function(selector){_destroyInputGroup(selector)},elements:function(form){var els={};$("input:text,input:hidden,select",$(form)).filter("[name]").each(function(i,e){els[e.name]=$(e)});return els}})})(window,undefined,jQuery);$(function(){$(document).delegate("a","focus",function(){this.blur()});if($(".haf-form-footer").size()>0){if($(".haf-form-footer .timer").size()>0){var a=null;var b=function(){a=setInterval(function(){var e=new Date();var d=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();$(".haf-form-footer .timer").html(d)},1000)};var c=function(){if(a){clearInterval(a)}};b()}$(".haf-form-footer a[href='#']").attr("href","javascript:void(0)");$(".haf-form-footer div a.hide-footer").click(function(){$(".haf-form-backdrop,.haf-form-content").removeClass("with-footer");$(".haf-form-footer").addClass("hide-footer")});$(".haf-form-footer > a.show-footer").click(function(){$(".haf-form-backdrop,.haf-form-content").addClass("with-footer");$(".haf-form-footer").removeClass("hide-footer")})}});